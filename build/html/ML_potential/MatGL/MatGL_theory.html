
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Theoretical foundation of M3GNET &#8212; Zhengda&#39;s Notes 0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=23995236" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=e1a75a79"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'ML_potential/MatGL/MatGL_theory';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Practical applications of MatGL" href="MatGL_practice.html" />
    <link rel="prev" title="MatGL" href="MatGL.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Zhengda's Notes 0.1 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../learning_notes/index.html">Learning Notes</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../learning_notes/machine_learning.html">Concepts in Machine Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../learning_notes/linux.html">Useful commands on Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../learning_notes/youtube_uni.html">Youtube as a university</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../learning_notes/scientific_writing.html">Scientific writing and research methodology</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">Machine learning potential</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../NequIP/NequIP.html">NequIP</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../NequIP/NequIP_theory.html">Theoretical background of NequIP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../NequIP/NequIP_practice.html">Practical use of NequIP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../NequIP/NequIP_test.html">Test of NequIP</a></li>
</ul>
</details></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="MatGL.html">MatGL</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">Theoretical foundation of M3GNET</a></li>
<li class="toctree-l3"><a class="reference internal" href="MatGL_practice.html">Practical applications of MatGL</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../mathematics/index.html">Wonder garden of mathematics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Treatise of computational chemistry</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../my_book/index.html">Treatise of computational chemistry</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/ML_potential/MatGL/MatGL_theory.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Theoretical foundation of M3GNET</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#network-architecture">Network architecture</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#molecular-graph-construction">Molecular graph construction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#message-passing">Message passing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-edge-feature-update">Step 1: Edge feature update</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#many-body-interaction">Many-body Interaction</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#regular-edge-features-update">Regular edge features update</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-node-feature-update">Step 2: Node feature update</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-global-feature-update">Step 3: Global feature update</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-global-pooling">Step 4: Global pooling</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#extensive-properties">Extensive properties</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#intensive-properties">Intensive properties</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loss-function">Loss function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="theoretical-foundation-of-m3gnet">
<h1>Theoretical foundation of M3GNET<a class="headerlink" href="#theoretical-foundation-of-m3gnet" title="Link to this heading">#</a></h1>
<p><a class="reference external" href="https://www.nature.com/articles/s43588-022-00349-3">M3GNET</a> is a graph neural network used for training interatomic potential based on DFT data. In this page, we will introduce its network architecture and the detailed mathematics used in the network.</p>
<section id="network-architecture">
<h2>Network architecture<a class="headerlink" href="#network-architecture" title="Link to this heading">#</a></h2>
<p>The architecture of the network is shown in <a class="reference internal" href="#fig-m3gnet"><span class="std std-numref">Fig. 6</span></a>.</p>
<figure class="align-center" id="fig-m3gnet">
<a class="reference internal image-reference" href="../../_images/m3gnet.png"><img alt="M3GNET architecture" src="../../_images/m3gnet.png" style="width: 300px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">M3GNET architecture. Copied from the original paper (Fig. 1).</span><a class="headerlink" href="#fig-m3gnet" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The basic architecture is typical graph neural network: featurization (structure to graph) <span class="math notranslate nohighlight">\(\longrightarrow\)</span> message passing (updating / convolution) <span class="math notranslate nohighlight">\(\longrightarrow\)</span> global pooling <span class="math notranslate nohighlight">\(\longrightarrow\)</span> output.</p>
<section id="molecular-graph-construction">
<h3>Molecular graph construction<a class="headerlink" href="#molecular-graph-construction" title="Link to this heading">#</a></h3>
<p>First we will featurize the atom (as nodes or vertices) and the bonds between atoms (as edges) into a graph.</p>
<p>In M3GNET, a graph object can be written as: <span class="math notranslate nohighlight">\(\mathcal{G} = (\mathcal{E},\mathcal{V},\mathcal{X}[\textbf{M}, \textbf{u}])\)</span>, where <span class="math notranslate nohighlight">\(\mathcal{E}\)</span> represents the collection of edges (<span class="math notranslate nohighlight">\(\{\vec{e}_{ij}\}\)</span>), <span class="math notranslate nohighlight">\(\mathcal{V}\)</span> represents the collection of vertices (<span class="math notranslate nohighlight">\(\{\vec{v}_i\}\)</span>), <span class="math notranslate nohighlight">\(\mathcal{X}\)</span> represents the location of all atoms, <span class="math notranslate nohighlight">\(\textbf{M}\)</span> represents the lattice constant of the material, and <span class="math notranslate nohighlight">\(\textbf{u}\)</span> represents the global feature vector, which can be used in enconding some additional information about the material, or the computational approaches. For example, in this <a class="reference external" href="https://www.nature.com/articles/s43588-020-00002-x">work</a>, they used global feature vector to encode the fidelity of the DFT calculation. Here are some further development in this direction: <a class="reference external" href="https://arxiv.org/abs/2409.00957">paper</a>.</p>
<p>In <code class="code docutils literal notranslate"><span class="pre">Graph</span> <span class="pre">featurizer</span></code>, the nodes (<span class="math notranslate nohighlight">\(\vec{v}_i\)</span>) are featurized into a <span class="math notranslate nohighlight">\(\vec{v}_i \in \mathbb{R}^{64\times 1}\)</span> vector. The edges (<span class="math notranslate nohighlight">\(\vec{e}_{ij}\)</span>) are featurized into a <span class="math notranslate nohighlight">\(\vec{e}_{ij} \in \mathbb{R}^{m\times 1}\)</span> vector, where <span class="math notranslate nohighlight">\(m\)</span> is the number of basis sets. The basis functions (<span class="math notranslate nohighlight">\(h_m(r_{ij})\)</span>) are shown in <a class="reference internal" href="#fig-basis-functions"><span class="std std-numref">Fig. 7</span></a>.</p>
<figure class="align-center" id="fig-basis-functions">
<a class="reference internal image-reference" href="../../_images/basis_functions_m3gnet_edge.png"><img alt="Basis functions" src="../../_images/basis_functions_m3gnet_edge.png" style="width: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Basis functions. Copied from the original paper (in Methods section).</span><a class="headerlink" href="#fig-basis-functions" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In the following, <span class="math notranslate nohighlight">\(e_{ij}^0\)</span> is used as a vector with length <span class="math notranslate nohighlight">\(m\)</span>, it can be written as:</p>
<div class="math notranslate nohighlight">
\[\begin{split}e_{ij}^0 = \begin{bmatrix}
h_1(r_{ij}) \\
h_2(r_{ij}) \\
\vdots \\
h_m(r_{ij}) \\
\end{bmatrix}\end{split}\]</div>
</section>
<section id="message-passing">
<h3>Message passing<a class="headerlink" href="#message-passing" title="Link to this heading">#</a></h3>
<p>After the featurization of the nodes and edges, we can update the nodes and edges using the message passing approach. There are three parts needed to be updated: (1) update the nodes using the edges, (2) update the edges using the nodes, (3) update the global feature vector using the nodes. We will introduce them individually.</p>
<section id="step-1-edge-feature-update">
<h4>Step 1: Edge feature update<a class="headerlink" href="#step-1-edge-feature-update" title="Link to this heading">#</a></h4>
<p>In M3GNET, the update of edge features needs two steps: the first step is to get the many-body interaction, the second step is like the regular updating of edge features.</p>
<section id="many-body-interaction">
<h5>Many-body Interaction<a class="headerlink" href="#many-body-interaction" title="Link to this heading">#</a></h5>
<p>For the many-body interaction, a Tersoff-like potential is used:</p>
<div class="math notranslate nohighlight">
\[(\tilde{e}_{ij})_{n,l} = \sum_k j_l(z_{ln}\frac{r_{ik}}{r_c})Y_l^0(\theta_{ijk})\odot \sigma(W_v\vec{v}_k+b_v)f_c(r_{ij})f_c(r_{ik})\]</div>
<p>where <span class="math notranslate nohighlight">\(j_l(z_{ln}\frac{r_{ik}}{r_c})\)</span> is the spherical Bessel function, <span class="math notranslate nohighlight">\(Y_l^0(\theta_{ijk})\)</span> is the spherical harmonic function, with <span class="math notranslate nohighlight">\(\theta_{ijk}\)</span> as the angle between the vectors <span class="math notranslate nohighlight">\(\vec{e}_{ij}\)</span> and <span class="math notranslate nohighlight">\(\vec{e}_{ik}\)</span>, which can be considered as the three-body interaction, that’s why this model is called <code class="code docutils literal notranslate"><span class="pre">M3GNET</span></code>, generally it should be called <code class="code docutils literal notranslate"><span class="pre">MnGNET</span></code>, where <span class="math notranslate nohighlight">\(n\)</span> is the number of body interactions considered, in the current case <span class="math notranslate nohighlight">\(n=3\)</span>.</p>
<p><span class="math notranslate nohighlight">\(\sigma(W_v\vec{v}_k+b_v)\)</span> is the activation function, <span class="math notranslate nohighlight">\(f_c(\cdot)\)</span> is the cutoff function, the expression is: <span class="math notranslate nohighlight">\(f_c(r_{ij}) = 1-6(r_{ij}/r_c)^5+15(r_{ij}/r_c)^4-10(r_{ij}/r_c)^3\)</span>. <span class="math notranslate nohighlight">\(\odot\)</span> represents the element-wise multiplication.</p>
<p>Then the edge features can be updated as:</p>
<div class="math notranslate nohighlight">
\[\vec{e}_{ij}^{'} = \vec{e}_{ij} + g(\tilde{W}_2\tilde{e}_{ij}+\tilde{b}_2)\odot \sigma(\tilde{W}_1\tilde{e}_{ij}+\tilde{b}_1)\]</div>
<p>where <span class="math notranslate nohighlight">\(g(\cdot)\)</span> is <span class="math notranslate nohighlight">\(g(x)=x\sigma(x)\)</span>, where <span class="math notranslate nohighlight">\(\sigma(\cdot)\)</span> is the sigmoid function (<span class="math notranslate nohighlight">\(\sigma(x)=(1+e^{-x})^{-1}\)</span>). <span class="math notranslate nohighlight">\(\vec{e}_{ij}^{'}\)</span> is the updated edge features, <span class="math notranslate nohighlight">\(\vec{e}_{ij}\)</span> is the original edge features.</p>
<p>The dimension of <span class="math notranslate nohighlight">\(\tilde{e}_{ij}\)</span> depends on the choices of <span class="math notranslate nohighlight">\(n\)</span> and <span class="math notranslate nohighlight">\(l\)</span>, in total the vector length of <span class="math notranslate nohighlight">\(\tilde{e}_{ij}\)</span> is <span class="math notranslate nohighlight">\(n_{\text{max}}l_{\text{max}}\)</span>.</p>
</section>
<section id="regular-edge-features-update">
<h5>Regular edge features update<a class="headerlink" href="#regular-edge-features-update" title="Link to this heading">#</a></h5>
<p>After considering the contribution of the many-body interactions, the edge features then can be updated conventionally:</p>
<div class="math notranslate nohighlight">
\[\vec{e}_{ij}^{'} = \vec{e}_{ij} + \phi_e^k(\vec{v}_i\oplus\vec{v}_j\oplus\vec{e}_{ij}\oplus\vec{u})W_e^0\vec{e}_{ij}^0\]</div>
<p>where <span class="math notranslate nohighlight">\(\oplus\)</span> represents the direct sum of the vectors, basically increase the dimension of the feature vectors, the meaning of the <span class="math notranslate nohighlight">\(\oplus\)</span> can be seen in the <code class="code docutils literal notranslate"><span class="pre">learning_notes</span></code>. the expression for <span class="math notranslate nohighlight">\(\vec{e}_{ij}^0\)</span> has been given above. In here <span class="math notranslate nohighlight">\(\phi_e^k\)</span> is a gated function, which can be written as:</p>
<div class="math notranslate nohighlight">
\[\phi_e^k(\vec{x}) = (\mathcal{L}_g^k\circ\mathcal{L}_g^{k-1}\circ\cdots\circ\mathcal{L}_g^1)\odot(\mathcal{L}_{\sigma}^k\circ\mathcal{L}_g^{k-1}\circ\cdots\circ\mathcal{L}_g^1)(\vec{x})\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{L}_g\)</span> is a linear layer with <span class="math notranslate nohighlight">\(g(\cdot)\)</span> as the activation function, <span class="math notranslate nohighlight">\(\mathcal{L}_{\sigma}\)</span> is a linear layer with <span class="math notranslate nohighlight">\(\sigma(\cdot)\)</span> as the activation function. <span class="math notranslate nohighlight">\(k\)</span> is the number of layers in the gated function.</p>
</section>
</section>
<section id="step-2-node-feature-update">
<h4>Step 2: Node feature update<a class="headerlink" href="#step-2-node-feature-update" title="Link to this heading">#</a></h4>
<p>The formula for node feature update is:</p>
<div class="math notranslate nohighlight">
\[\vec{v}_i^{'} = \vec{v}_i + \sum_j\phi_v^{k}(\vec{v}_i\oplus\vec{v}_j\oplus\vec{e}_{ij}^{'}\oplus\vec{u})W_e^{0'}\vec{e}_{ij}^0\]</div>
<p>In here, in the paper they used <span class="math notranslate nohighlight">\(\phi_e^{'}(\cdot)\)</span> as the updating function, but since it represents the update of the feature vector of the vertices, I used <span class="math notranslate nohighlight">\(\phi_v^{k}(\cdot)\)</span>, where <span class="math notranslate nohighlight">\(k\)</span> is the number of layers in the MLP.</p>
</section>
<section id="step-3-global-feature-update">
<h4>Step 3: Global feature update<a class="headerlink" href="#step-3-global-feature-update" title="Link to this heading">#</a></h4>
<div class="math notranslate nohighlight">
\[\vec{u}^{'} = g(W_2^ug(W_1^u(\frac{1}{N_v}\sum_{i=1}^{N_v}\vec{v}_i\oplus\vec{u})+\vec{b}_1^u)+\vec{b}_2^u)\]</div>
<p>where <span class="math notranslate nohighlight">\(N_v\)</span> is the number of vertices in the graph.</p>
</section>
<section id="step-4-global-pooling">
<h4>Step 4: Global pooling<a class="headerlink" href="#step-4-global-pooling" title="Link to this heading">#</a></h4>
<p>After message passing procedure, M3GNET uses feature vectors of nodes (vertices) to predict the properties of the material.</p>
<section id="extensive-properties">
<h5>Extensive properties<a class="headerlink" href="#extensive-properties" title="Link to this heading">#</a></h5>
<p>For the extensive properties such as total energy, a three-layer gated MLP is used:</p>
<div class="math notranslate nohighlight">
\[p_{ext} = \sum_i\phi_3(\{\vec{v}_i\})\]</div>
<p>where <span class="math notranslate nohighlight">\(\phi_3(\cdot)\)</span> is a three-layer gated MLP, the number of hidden nodes for each layer is: <span class="math notranslate nohighlight">\([64, 64, 1]\)</span>, for the last layer, no activation function is used.</p>
</section>
<section id="intensive-properties">
<h5>Intensive properties<a class="headerlink" href="#intensive-properties" title="Link to this heading">#</a></h5>
<p>For the intensive properties, the readout step was performed:</p>
<div class="math notranslate nohighlight">
\[p_{int} = \xi_3(\sum_iw_i\xi_2(\vec{v}_i\oplus\vec{u}))\]</div>
<p>where the weights (<span class="math notranslate nohighlight">\(w_i\)</span>) are calculated by:</p>
<div class="math notranslate nohighlight">
\[w_i = \frac{\xi_3^{'}{(\vec{v}_i)}}{\sum_i\xi_3^{'}{(\vec{v}_i)}}\]</div>
</section>
</section>
</section>
</section>
<section id="loss-function">
<h2>Loss function<a class="headerlink" href="#loss-function" title="Link to this heading">#</a></h2>
<p>The loss function is:</p>
<div class="math notranslate nohighlight">
\[L=l(e_{\text{pred}}, e_{\text{DFT}}) + w_fL_f(f_{\text{pred}}, f_{\text{DFT}}) + w_{\sigma}l(\sigma_{\text{pred}}, \sigma_{\text{DFT}})\]</div>
<p>where <span class="math notranslate nohighlight">\(l(\cdot)\)</span> is the Huber loss function.</p>
</section>
<section id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>In M3GNET, during the message passing procedure, the length of edge and node features remain unchanged. Unlike in NequIP, where the length of the node features increases after each tensor product with the edge features.</p></li>
</ul>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="MatGL.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">MatGL</p>
      </div>
    </a>
    <a class="right-next"
       href="MatGL_practice.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Practical applications of MatGL</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#network-architecture">Network architecture</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#molecular-graph-construction">Molecular graph construction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#message-passing">Message passing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-edge-feature-update">Step 1: Edge feature update</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#many-body-interaction">Many-body Interaction</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#regular-edge-features-update">Regular edge features update</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-node-feature-update">Step 2: Node feature update</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-global-feature-update">Step 3: Global feature update</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-global-pooling">Step 4: Global pooling</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#extensive-properties">Extensive properties</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#intensive-properties">Intensive properties</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loss-function">Loss function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Zhengda He
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Zhengda He.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>