
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Aqueous stability of metal and metal (oxy)(hydr)oxides &#8212; Zhengda&#39;s Library 0.0.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=23995236" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=e645c8fa"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'research_notes/aqueous_stability_mp';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Machine learning potential" href="../ML_potential/index.html" />
    <link rel="prev" title="Research Notes" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">Zhengda's Library 0.0.1 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../learning_notes/index.html">Learning Notes</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../learning_notes/machine_learning.html">Concepts in Machine Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learning_notes/linux.html">Useful commands on Linux</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learning_notes/youtube_uni.html">Youtube as a university</a></li>
<li class="toctree-l2"><a class="reference internal" href="../learning_notes/scientific_writing.html">Scientific writing and research methodology</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">Research Notes</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Aqueous stability of metal and metal (oxy)(hydr)oxides</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../ML_potential/index.html">Machine learning potential</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../ML_potential/NequIP/NequIP.html">NequIP</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../ML_potential/NequIP/NequIP_theory.html">Theoretical background of NequIP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ML_potential/NequIP/NequIP_practice.html">Practical use of NequIP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ML_potential/NequIP/NequIP_test.html">Test of NequIP</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../ML_potential/MatGL/MatGL.html">MatGL</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../ML_potential/MatGL/MatGL_theory.html">Theoretical foundation of M3GNET</a></li>
<li class="toctree-l3"><a class="reference internal" href="../ML_potential/MatGL/MatGL_practice.html">Practical applications of MatGL</a></li>
</ul>
</details></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../daily_notes/index.html">Daily Notes</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../daily_notes/20240923.html">09/23/2024</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daily_notes/20240924.html">09/24/2024</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daily_notes/20240925.html">09/25/2024</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daily_notes/20240927.html">09/27/2024</a></li>
<li class="toctree-l2"><a class="reference internal" href="../daily_notes/20240928.html">09/28/2024</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../mathematics/index.html">Wonder garden of mathematics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Treatise of computational chemistry</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../my_book/index.html">Treatise of computational chemistry</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/research_notes/aqueous_stability_mp.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Aqueous stability of metal and metal (oxy)(hydr)oxides</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstract">Abstract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods">Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#collect-a-dataset-of-metal-and-metal-oxy-hydr-oxide-compounds">Collect a dataset of metal and metal (oxy)(hydr)oxide compounds</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#collect-pourbaix-diagrams">Collect pourbaix diagrams</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-the-stability-range-of-ph-and-voltage-for-each-compound">Determine the stability range of pH and voltage for each compound</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-analysis">Statistical analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-of-stable-regions">Distribution of stable regions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-of-binary-oxides">Stability of binary oxides</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-of-ternary-and-higher-order-oxides">Stability of ternary and higher-order oxides</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#synergistic-and-antagonistic-effects">Synergistic and Antagonistic effects</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#synergistic-effects">Synergistic effects</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#antagonistic-effects">Antagonistic effects</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix">Appendix</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="aqueous-stability-of-metal-and-metal-oxy-hydr-oxides">
<h1>Aqueous stability of metal and metal (oxy)(hydr)oxides<a class="headerlink" href="#aqueous-stability-of-metal-and-metal-oxy-hydr-oxides" title="Link to this heading">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The purpose of this project is to check the aqueous stability of metal and metal (oxy)(hydr)oxides and develop some statistical insights of the results.</p>
</div>
<section id="abstract">
<h2>Abstract<a class="headerlink" href="#abstract" title="Link to this heading">#</a></h2>
</section>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
</section>
<section id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Link to this heading">#</a></h2>
<section id="collect-a-dataset-of-metal-and-metal-oxy-hydr-oxide-compounds">
<h3>Collect a dataset of metal and metal (oxy)(hydr)oxide compounds<a class="headerlink" href="#collect-a-dataset-of-metal-and-metal-oxy-hydr-oxide-compounds" title="Link to this heading">#</a></h3>
<p>We have extract all the compositions and corresponding Pourbaix diagrams from Materials Project. The MP interface API was used to extract all the data. The data extraction script for all compositions (<code class="code docutils literal notranslate"><span class="pre">extract_comps.py</span></code>) is shown in below:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3 sd-fade-in">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">extract_comps.py</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">monty.serialization</span> <span class="kn">import</span> <span class="n">loadfn</span><span class="p">,</span> <span class="n">dumpfn</span>
<span class="kn">from</span> <span class="nn">aqueous_stability</span> <span class="kn">import</span> <span class="n">AqueousStabilityWorker</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>

<span class="c1"># Constants</span>
<span class="n">ELE_LST</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Li&#39;</span><span class="p">,</span> <span class="s1">&#39;Be&#39;</span><span class="p">,</span> <span class="s1">&#39;Na&#39;</span><span class="p">,</span> <span class="s1">&#39;Mg&#39;</span><span class="p">,</span> <span class="s1">&#39;Al&#39;</span><span class="p">,</span> <span class="s1">&#39;K&#39;</span><span class="p">,</span> <span class="s1">&#39;Ca&#39;</span><span class="p">,</span> <span class="s1">&#39;Sc&#39;</span><span class="p">,</span> <span class="s1">&#39;Ti&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="s1">&#39;Cr&#39;</span><span class="p">,</span> <span class="s1">&#39;Mn&#39;</span><span class="p">,</span> <span class="s1">&#39;Fe&#39;</span><span class="p">,</span> <span class="s1">&#39;Co&#39;</span><span class="p">,</span> <span class="s1">&#39;Ni&#39;</span><span class="p">,</span> <span class="s1">&#39;Cu&#39;</span><span class="p">,</span> <span class="s1">&#39;Zn&#39;</span><span class="p">,</span> <span class="s1">&#39;Ga&#39;</span><span class="p">,</span> <span class="s1">&#39;Rb&#39;</span><span class="p">,</span> <span class="s1">&#39;Sr&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;Zr&#39;</span><span class="p">,</span> <span class="s1">&#39;Nb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mo&#39;</span><span class="p">,</span> <span class="s1">&#39;Ru&#39;</span><span class="p">,</span> <span class="s1">&#39;Rh&#39;</span><span class="p">,</span> <span class="s1">&#39;Pd&#39;</span><span class="p">,</span> <span class="s1">&#39;Ag&#39;</span><span class="p">,</span> <span class="s1">&#39;Sn&#39;</span><span class="p">,</span> <span class="s1">&#39;Sb&#39;</span><span class="p">,</span> <span class="s1">&#39;Cs&#39;</span><span class="p">,</span> <span class="s1">&#39;Ba&#39;</span><span class="p">,</span> <span class="s1">&#39;Hf&#39;</span><span class="p">,</span> <span class="s1">&#39;Ta&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;Re&#39;</span><span class="p">,</span> <span class="s1">&#39;Os&#39;</span><span class="p">,</span> <span class="s1">&#39;Ir&#39;</span><span class="p">,</span> <span class="s1">&#39;Pt&#39;</span><span class="p">,</span> <span class="s1">&#39;Au&#39;</span><span class="p">,</span>
<span class="s1">&#39;In&#39;</span><span class="p">,</span> <span class="s1">&#39;Ge&#39;</span><span class="p">,</span> <span class="s1">&#39;Pb&#39;</span><span class="p">,</span> <span class="s1">&#39;La&#39;</span><span class="p">,</span> <span class="s1">&#39;Bi&#39;</span><span class="p">]</span>

<span class="c1"># Functions</span>
<span class="k">def</span> <span class="nf">load_existing_data</span><span class="p">():</span>
    <span class="n">lst_processed_combs</span> <span class="o">=</span> <span class="n">loadfn</span><span class="p">(</span><span class="s1">&#39;processed_combs.mson&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;processed_combs.mson&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="n">all_comps</span> <span class="o">=</span> <span class="n">loadfn</span><span class="p">(</span><span class="s1">&#39;all_comps.mson&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;all_comps.mson&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="k">return</span> <span class="n">lst_processed_combs</span><span class="p">,</span> <span class="n">all_comps</span>

<span class="k">def</span> <span class="nf">generate_combinations</span><span class="p">(</span><span class="n">max_length</span><span class="p">):</span>
    <span class="n">lst_combs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_length</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">combos</span> <span class="o">=</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">ELE_LST</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">combos</span><span class="p">:</span>
            <span class="n">lst_combs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="s1">&#39;H&#39;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">lst_combs</span>

<span class="k">def</span> <span class="nf">process_combo</span><span class="p">(</span><span class="n">combo</span><span class="p">):</span>
    <span class="n">comp_name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span>
    <span class="n">asw</span> <span class="o">=</span> <span class="n">AqueousStabilityWorker</span><span class="p">(</span><span class="n">comp_name</span><span class="p">,</span> <span class="n">c_ion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">is_pbd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pbd</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">pbd</span> <span class="o">=</span> <span class="n">asw</span><span class="o">.</span><span class="n">pbd</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">random</span><span class="p">())</span>
    <span class="n">stable_entries</span> <span class="o">=</span> <span class="n">pbd</span><span class="o">.</span><span class="n">stable_entries</span>

    <span class="n">local_all_comps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tmp_entry</span> <span class="ow">in</span> <span class="n">stable_entries</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;phase_type&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">tmp_entry</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tmp_entry</span><span class="o">.</span><span class="n">phase_type</span> <span class="o">==</span> <span class="s1">&#39;Solid&#39;</span><span class="p">:</span>
                <span class="n">comp_name</span> <span class="o">=</span> <span class="n">tmp_entry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">comp_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_all_comps</span><span class="p">:</span>
                    <span class="n">local_all_comps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tmp_entry</span><span class="o">.</span><span class="n">entry_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;phase_type&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">entry</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">phase_type</span> <span class="o">==</span> <span class="s1">&#39;Solid&#39;</span><span class="p">:</span>
                        <span class="n">comp_name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">comp_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_all_comps</span><span class="p">:</span>
                            <span class="n">local_all_comps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">combo</span><span class="p">,</span> <span class="n">local_all_comps</span>

<span class="k">def</span> <span class="nf">save_results</span><span class="p">(</span><span class="n">lst_processed_combs</span><span class="p">,</span> <span class="n">all_comps</span><span class="p">):</span>
    <span class="n">dumpfn</span><span class="p">(</span><span class="n">lst_processed_combs</span><span class="p">,</span> <span class="s1">&#39;processed_combs.mson&#39;</span><span class="p">)</span>
    <span class="n">dumpfn</span><span class="p">(</span><span class="n">all_comps</span><span class="p">,</span> <span class="s1">&#39;all_comps.mson&#39;</span><span class="p">)</span>

<span class="c1"># Main script</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Process combinations with multiprocessing.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;--num_processors&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Number of processors to use&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--max_combination_length&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Maximum combination length&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">lst_processed_combs</span><span class="p">,</span> <span class="n">all_comps</span> <span class="o">=</span> <span class="n">load_existing_data</span><span class="p">()</span>
    <span class="n">lst_combs</span> <span class="o">=</span> <span class="n">generate_combinations</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">max_combination_length</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total combinations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_combs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">num_processors</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">process_combo</span><span class="p">,</span> <span class="p">[</span><span class="n">combo</span> <span class="k">for</span> <span class="n">combo</span> <span class="ow">in</span> <span class="n">lst_combs</span> <span class="k">if</span> <span class="n">combo</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lst_processed_combs</span><span class="p">]),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_combs</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_processed_combs</span><span class="p">)):</span>
            <span class="n">combo</span><span class="p">,</span> <span class="n">local_all_comps</span> <span class="o">=</span> <span class="n">result</span>
            <span class="n">lst_processed_combs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">combo</span><span class="p">)</span>
            <span class="n">all_comps</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">comp</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">local_all_comps</span> <span class="k">if</span> <span class="n">comp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_comps</span><span class="p">])</span>

            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">save_results</span><span class="p">(</span><span class="n">lst_processed_combs</span><span class="p">,</span> <span class="n">all_comps</span><span class="p">)</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">save_results</span><span class="p">(</span><span class="n">lst_processed_combs</span><span class="p">,</span> <span class="n">all_comps</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details><p>Some notes about the script above:</p>
<ul class="simple">
<li><p>We are using <cite>multiprocessing</cite> to speed up the data extraction.</p></li>
<li><p>We are using <cite>pickle</cite> to save and re-read the data more efficiently.</p></li>
<li><p>The <code class="code docutils literal notranslate"><span class="pre">aqueous_stability</span></code> package is a custom package for this project, which we will put in the appendix in this page.</p></li>
</ul>
<p>The actual data extraction was done on <code class="code docutils literal notranslate"><span class="pre">Kestrel</span></code>. The folder is: <code class="code docutils literal notranslate"><span class="pre">/home/hez/new_pourbaix_comp</span></code>. Besides the extraction code, I also write a shell script to run it automatically and dealing with issues like the server blocks me because of too many requests.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3 sd-fade-in">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">extract_comps.sh</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/sh</span>
<span class="linenos"> 2</span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..10000<span class="o">}</span>
<span class="linenos"> 3</span><span class="k">do</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$i</span><span class="s2">-th loop&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>log_auto
<span class="linenos"> 5</span><span class="w">    </span>python3<span class="w"> </span>extract_comps.py<span class="w"> </span>-n<span class="w"> </span><span class="m">24</span><span class="w"> </span>-c<span class="w"> </span><span class="m">3</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;sleep for 2 minutes to make sure the server forgets about me ......&quot;</span>
<span class="linenos"> 7</span><span class="w">    </span>sleep<span class="w"> </span>2m
<span class="linenos"> 8</span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;come back to life and go attack again&quot;</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>log_auto
<span class="linenos">10</span><span class="k">done</span>
</pre></div>
</div>
</div>
</details><p>The results were saved in <code class="code docutils literal notranslate"><span class="pre">/Users/zhengdahe/Library/CloudStorage/Dropbox/proj_StabilityWindow_Catalysts/figures_addInGePbLaBi/Figure_1</span></code>.</p>
</section>
<section id="collect-pourbaix-diagrams">
<h3>Collect pourbaix diagrams<a class="headerlink" href="#collect-pourbaix-diagrams" title="Link to this heading">#</a></h3>
<p>Besides all the compositions mentioned above, we also collected all relevant pourbaix diagrams constructed by using <code class="code docutils literal notranslate"><span class="pre">pymatgen</span></code> package. The code for extracting pourbaix diagrams (<code class="code docutils literal notranslate"><span class="pre">extract_pbds.py</span></code>) is shown in below:</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3 sd-fade-in">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">extract_pbds.py</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Imports</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">monty.serialization</span> <span class="kn">import</span> <span class="n">loadfn</span><span class="p">,</span> <span class="n">dumpfn</span>
<span class="kn">from</span> <span class="nn">aqueous_stability</span> <span class="kn">import</span> <span class="n">AqueousStabilityWorker</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>

<span class="c1"># Functions</span>
<span class="k">def</span> <span class="nf">load_existing_data</span><span class="p">():</span>
    <span class="n">lst_processed_comps</span> <span class="o">=</span> <span class="n">loadfn</span><span class="p">(</span><span class="s1">&#39;processed_comps_pbds.mson&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;processed_comps_pbds.mson&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span> <span class="k">else</span> <span class="p">[]</span>
    <span class="n">all_pbds</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;all_pbds.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">))</span> <span class="k">if</span> <span class="s1">&#39;all_pbds.pkl&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">()</span> <span class="k">else</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">lst_processed_comps</span><span class="p">,</span> <span class="n">all_pbds</span>

<span class="k">def</span> <span class="nf">process_comps</span><span class="p">(</span><span class="n">comp</span><span class="p">):</span>
    <span class="n">asw</span> <span class="o">=</span> <span class="n">AqueousStabilityWorker</span><span class="p">(</span><span class="n">comp</span><span class="p">,</span> <span class="n">c_ion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">is_pbd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pbd</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">pbd</span> <span class="o">=</span> <span class="n">asw</span><span class="o">.</span><span class="n">pbd</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">random</span><span class="p">())</span>

    <span class="k">return</span> <span class="n">comp</span><span class="p">,</span> <span class="n">pbd</span>

<span class="k">def</span> <span class="nf">save_results</span><span class="p">(</span><span class="n">lst_processed_comps</span><span class="p">,</span> <span class="n">all_pbds</span><span class="p">):</span>
    <span class="n">dumpfn</span><span class="p">(</span><span class="n">lst_processed_comps</span><span class="p">,</span> <span class="s1">&#39;processed_comps_pbds.mson&#39;</span><span class="p">)</span>
    <span class="c1">#dumpfn(all_pbds, &#39;all_pbds.mson&#39;)</span>

    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;all_pbds.pkl&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">all_pbds</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="c1"># Main script</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">&#39;Process combinations with multiprocessing.&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-n&#39;</span><span class="p">,</span> <span class="s1">&#39;--num_processors&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Number of processors to use&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;--max_combination_length&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;Maximum combination length&#39;</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="n">lst_processed_comps</span><span class="p">,</span> <span class="n">all_pbds</span> <span class="o">=</span> <span class="n">load_existing_data</span><span class="p">()</span>
    <span class="n">lst_comps</span> <span class="o">=</span> <span class="n">loadfn</span><span class="p">(</span><span class="s1">&#39;all_comps.mson&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total number of compounds: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_comps</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span><span class="n">processes</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">num_processors</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">imap_unordered</span><span class="p">(</span><span class="n">process_comps</span><span class="p">,</span> <span class="p">[</span><span class="n">comp</span> <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">lst_comps</span> <span class="k">if</span> <span class="n">comp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lst_processed_comps</span><span class="p">]),</span> <span class="n">total</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_comps</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_processed_comps</span><span class="p">)):</span>
            <span class="n">comp</span><span class="p">,</span> <span class="n">pbd</span> <span class="o">=</span> <span class="n">result</span>
            <span class="n">lst_processed_comps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span>
            <span class="n">all_pbds</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">comp</span><span class="p">:</span> <span class="n">pbd</span><span class="p">})</span>

            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">50</span><span class="p">:</span>
                <span class="n">save_results</span><span class="p">(</span><span class="n">lst_processed_comps</span><span class="p">,</span> <span class="n">all_pbds</span><span class="p">)</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">save_results</span><span class="p">(</span><span class="n">lst_processed_comps</span><span class="p">,</span> <span class="n">all_pbds</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details><p>The executing script (<code class="code docutils literal notranslate"><span class="pre">extract_pbds.sh</span></code>) is similar to the one for compositions.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<ul class="simple">
<li><p>When we generate the pourbaix diagram, the composition should be the same as the target compound. For example, if we want to generate the pourbaix diagram for <span class="math notranslate nohighlight">\(\rm Li_2MoO_4\)</span>, then the composition of the Pourbaix diagram should be <code class="code docutils literal notranslate"><span class="pre">{'Li':2,'Mo':1}</span></code>. An advantage of this is that we don’t have solid compounds that is stable in multiple regions.</p></li>
<li><p>After we have generated the Pourbaix diagram, we need to screen again to find the missing stable solid entries. Then we will search for the new Pourbaix diagram until all the stable solid entries are found, which means no new solid entries were found.</p></li>
</ul>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3 sd-fade-in">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">extract_pbds.sh</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="ch">#!/usr/bin/sh</span>
<span class="linenos"> 2</span><span class="k">for</span><span class="w"> </span>i<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">{</span><span class="m">1</span>..10000<span class="o">}</span>
<span class="linenos"> 3</span><span class="k">do</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="nv">$i</span><span class="s2">-th loop&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>log_auto
<span class="linenos"> 5</span><span class="w">    </span>python3<span class="w"> </span>extract_pbds.py<span class="w"> </span>-n<span class="w"> </span><span class="m">12</span><span class="w"> </span>-c<span class="w"> </span><span class="m">3</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;sleep for 2 minutes to make sure the server forgets about me ......&quot;</span>
<span class="linenos"> 7</span><span class="w">    </span>sleep<span class="w"> </span>2m
<span class="linenos"> 8</span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;come back to life and go attack again&quot;</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="nb">echo</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>log_auto
<span class="linenos">10</span><span class="k">done</span>
</pre></div>
</div>
</div>
</details></section>
<section id="determine-the-stability-range-of-ph-and-voltage-for-each-compound">
<h3>Determine the stability range of pH and voltage for each compound<a class="headerlink" href="#determine-the-stability-range-of-ph-and-voltage-for-each-compound" title="Link to this heading">#</a></h3>
<p>In order to get the stability range of pH and voltage for each compound, we need to do the Pourbaix diagram analysis. First, we need to determine the stable region for each compound. Then we need to find the bounary based on the vertices of each region. In below is a schematic diagram for this process:</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/stable_pH_V_range.png"><img alt="../_images/stable_pH_V_range.png" src="../_images/stable_pH_V_range.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Schematic diagram for determining the stable pH and V range for a given compound.</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>There are two steps to get the stable pH and V range for a given compound:</p>
<ol class="arabic simple">
<li><p>Determine the stable region(s) for each compound.</p></li>
<li><p>Find the bounary based on the combined vertices of all regions.</p></li>
</ol>
<p>Let’s look at the first point, the code is in <code class="code docutils literal notranslate"><span class="pre">aqueous_stability.py</span></code>. I only show the most relevant part in below.</p>
<div class="admonition-algorithm admonition">
<p class="admonition-title">Algorithm</p>
<ul class="simple">
<li><p><strong>Step 1</strong>: Scan all the stable entries in the pourbaix diagram (<code class="code docutils literal notranslate"><span class="pre">pbd.get_pourbaix_domains</span></code>)</p></li>
<li><p><strong>Step 2.1</strong>: For each stable entry, if it is <code class="code docutils literal notranslate"><span class="pre">PourbaixEntry</span></code> (with <code class="code docutils literal notranslate"><span class="pre">phase_type</span></code> attribute), then check if it is solid. If it is not solid, then skip it. If it is solid, then check if it is the target phase. If it is, then add it to the list.</p></li>
<li><p><strong>Step 2.2</strong>: For each stable entry, if it is not <code class="code docutils literal notranslate"><span class="pre">PourbaixEntry</span></code> (i.e. it is a <code class="code docutils literal notranslate"><span class="pre">PourbaixMultiEntry</span></code>), then for each entry in the <code class="code docutils literal notranslate"><span class="pre">entry_list</span></code>, check if it is solid. If it is not solid, then skip it. If it is solid, then check if it is the target phase. If it is, then add it to the list.</p></li>
<li><p><strong>Step 3</strong>: Return the list of all stable entries that are solid and the target phase.</p></li>
</ul>
</div>
<p>Once we have the stable solid entries, we can determine its stable region, and figure out the shared region with stable region of water (<span class="math notranslate nohighlight">\(\rm pH=0\rightarrow 14, U_{RHE}=0\rightarrow 1.23V\)</span>)</p>
</section>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h2>
<section id="statistical-analysis">
<h3>Statistical analysis<a class="headerlink" href="#statistical-analysis" title="Link to this heading">#</a></h3>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/aqueous_stability_compounds_statistics.png"><img alt="../_images/aqueous_stability_compounds_statistics.png" src="../_images/aqueous_stability_compounds_statistics.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">Statistical analysis of all stable solid compounds. (a) Selected elements (colored in dark blue) shown in the periodic table. (b) Number of compounds for each material family. (c) The distribution of the number of compounds for each family across different elements</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="distribution-of-stable-regions">
<h3>Distribution of stable regions<a class="headerlink" href="#distribution-of-stable-regions" title="Link to this heading">#</a></h3>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../_images/aqueous_stability_stable_region_distribution.png"><img alt="../_images/aqueous_stability_stable_region_distribution.png" src="../_images/aqueous_stability_stable_region_distribution.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">Distribution of stable regions for all families of compounds: (a) metal (b) intermetllic compounds (c) binary oxides (d) ternary and higher-order oxides. For each family, three examples were given, the corresponding color</span><a class="headerlink" href="#id3" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="stability-of-binary-oxides">
<h3>Stability of binary oxides<a class="headerlink" href="#stability-of-binary-oxides" title="Link to this heading">#</a></h3>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../_images/aqueous_stability_stability_binary_oxides.png"><img alt="../_images/aqueous_stability_stability_binary_oxides.png" src="../_images/aqueous_stability_stability_binary_oxides.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Stable (a) pH and (b) voltage ranges for binary oxides. In (a), the dashed grey line represents <span class="math notranslate nohighlight">\(\rm pH=7\)</span>. The oxidation state of the metal atoms are shown in different saturation, with the highest oxidation state shown in the darkest color, the corresponding colorbar is shown on the right. The value of corresponding oxidation state for each bar is also shown on both panels.</span><a class="headerlink" href="#id4" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="stability-of-ternary-and-higher-order-oxides">
<h3>Stability of ternary and higher-order oxides<a class="headerlink" href="#stability-of-ternary-and-higher-order-oxides" title="Link to this heading">#</a></h3>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../_images/aqueous_stability_stable_ternary_higher_oxides.png"><img alt="../_images/aqueous_stability_stable_ternary_higher_oxides.png" src="../_images/aqueous_stability_stable_ternary_higher_oxides.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 5 </span><span class="caption-text">Stability of ternary and higher-order oxides with comparison to decomposed binary oxides. (a) All decomposed binary oxides are stable and the stable regions overlap. The stable pH and voltage ranges for two selected compounds are shown in (d) and (g), respectively. The black vertial line divides two examples. (b) All decomposed binary oxides are stable, but they do not overlap. The stable pH and voltage ranges for two selected compounds are shown in (e) and (h), respectively. (c) Not all decomposed binary oxides are stable. The stable pH and voltage ranges for two selected compounds are shown in (f) and (i), respectively.</span><a class="headerlink" href="#id5" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Link to this heading">#</a></h2>
<section id="synergistic-and-antagonistic-effects">
<h3>Synergistic and Antagonistic effects<a class="headerlink" href="#synergistic-and-antagonistic-effects" title="Link to this heading">#</a></h3>
<p>In this part, we will explore the synergistic and antagonistic effects of intermetallic compounds and oxides. The definition of the synergistic and antagonistic effects are:</p>
<ul class="simple">
<li><dl class="simple">
<dt>Synergistic effects:</dt><dd><ul>
<li><p>condition 1: (element A not stable) or (element B not stable)</p></li>
<li><p>condition 2: (element A is stable) and (element B is stable) and (element A &amp; B do not overlap) and (AB is stable)</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Antagonistic effects:</dt><dd><ul>
<li><p>(element A is stable) and (element B is stable) and (AB is not stable)</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>For intermetallic compounds, the A and B are pure metal phases, but for oxides, A and B represents the binary oxide phases.</p>
<section id="synergistic-effects">
<h4>Synergistic effects<a class="headerlink" href="#synergistic-effects" title="Link to this heading">#</a></h4>
<figure class="align-center" id="id6">
<a class="reference internal image-reference" href="../_images/aqueous_stability_syn_im_ox.png"><img alt="../_images/aqueous_stability_syn_im_ox.png" src="../_images/aqueous_stability_syn_im_ox.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 6 </span><span class="caption-text">Heatmap of synergistic effects for intermetallic compounds (lower left) and oxides (upper right). Each block represents the number of compounds that exhibit synergistic effects.</span><a class="headerlink" href="#id6" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="antagonistic-effects">
<h4>Antagonistic effects<a class="headerlink" href="#antagonistic-effects" title="Link to this heading">#</a></h4>
<figure class="align-center" id="id7">
<a class="reference internal image-reference" href="../_images/aqueous_stability_ant_im_ox.png"><img alt="../_images/aqueous_stability_ant_im_ox.png" src="../_images/aqueous_stability_ant_im_ox.png" style="width: 600px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 7 </span><span class="caption-text">Heatmap of antagonistic effects for intermetallic compounds (lower left) and oxides (upper right). Each block represents the number of compounds that exhibit antagonistic effects.</span><a class="headerlink" href="#id7" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Link to this heading">#</a></h2>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
</section>
<section id="appendix">
<h2>Appendix<a class="headerlink" href="#appendix" title="Link to this heading">#</a></h2>
<p>This is all the code for <code class="code docutils literal notranslate"><span class="pre">aqueous_stability.py</span></code> file. It defines the <code class="code docutils literal notranslate"><span class="pre">AqueousStabilityWorker</span></code> class, which is used to handle the pourbaix diagram and also the stability analysis of compounds.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3 sd-fade-in">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">aqueous_stability.py</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">mp_api.client</span> <span class="kn">import</span> <span class="n">MPRester</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">shapely</span> <span class="kn">import</span> <span class="n">intersection</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Composition</span>
<span class="kn">from</span> <span class="nn">pymatgen.analysis.pourbaix_diagram</span> <span class="kn">import</span> <span class="n">PourbaixDiagram</span>
<span class="kn">from</span> <span class="nn">pymatgen.analysis.phase_diagram</span> <span class="kn">import</span> <span class="n">PhaseDiagram</span>
<span class="kn">from</span> <span class="nn">pymatgen.entries.computed_entries</span> <span class="kn">import</span> <span class="n">ComputedEntry</span>

<span class="c1"># To-do list</span>
<span class="c1"># * Add return format after each function</span>

<span class="k">class</span> <span class="nc">AqueousStabilityWorker</span><span class="p">():</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">c_ion</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">is_pbd</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pbd</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialization function for AqueousStabilityWorkder object.</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">        * comp: Composition (string)</span>
<span class="sd">        * is_pbd: Whether we can provide the Pourbaix Diagram or not (boolean, default is False)</span>
<span class="sd">        * pbd: Provided pourbaix diagram (pymatgen PourbaixDiagram object, default is None)</span>
<span class="sd">        * c_ion: The concentration of ions that we want for the Pourbaix Diagram (float, default is 1.0M)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># when Pourbaix diagram is given</span>
        <span class="k">if</span> <span class="n">is_pbd</span><span class="p">:</span>
            <span class="c1">#print(&#39;You have provided an pre-calculated Pourbaix Diagram. Thank you.&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_ion</span> <span class="o">=</span> <span class="n">c_ion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pbd</span> <span class="o">=</span> <span class="n">pbd</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#print(f&#39;Generating Pourbaix Diagram for the composition {comp} ...&#39;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">comp</span> <span class="o">=</span> <span class="n">comp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_ion</span> <span class="o">=</span> <span class="n">c_ion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pbd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getPourbaixDiagram</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c_ion</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getGpbxAtpHAndV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_comp</span><span class="p">,</span> <span class="n">pH</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the pourbaix decomposition energy at certain (pH, V) for the target compounds comp.</span>

<span class="sd">        Keyword argument:</span>
<span class="sd">        * comp: The target composition (string)</span>
<span class="sd">        * pH: The pH we want to investigate (float)</span>
<span class="sd">        * V: The voltage we want to get (float)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pbd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbd</span>
        <span class="n">target_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findTargetEntry</span><span class="p">(</span><span class="n">target_comp</span><span class="o">=</span><span class="n">target_comp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pbd</span><span class="o">.</span><span class="n">get_decomposition_energy</span><span class="p">(</span><span class="n">target_entry</span><span class="p">,</span> <span class="n">pH</span><span class="p">,</span> <span class="n">V</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getStablepHRangeAndVoltageRange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_comp</span><span class="p">,</span> <span class="n">pH_range</span><span class="p">,</span> <span class="n">V_range</span><span class="p">,</span> <span class="n">voltage_scale</span><span class="o">=</span><span class="s1">&#39;SHE&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get stable pH range and voltange range.</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">        * target_comp: The composition of the target compounds (string)</span>
<span class="sd">        * pH_range: The desired pH range we want to investigate (list)</span>
<span class="sd">        * V_range: The voltage range that we want to investigate (list)</span>
<span class="sd">        * voltage_scale: the reference scale of voltage. We can choose &quot;SHE&quot; (reference doesn&#39;t change with pH) or &quot;RHE&quot; (reference changes with pH).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">ceil</span>

        <span class="n">pbd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbd</span>
        <span class="n">lst_multiEntry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__findTargetEntry</span><span class="p">(</span><span class="n">target_comp</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst_multiEntry</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]],</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]],</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>

        <span class="n">stable_domains</span> <span class="o">=</span> <span class="n">pbd</span><span class="o">.</span><span class="n">get_pourbaix_domains</span><span class="p">(</span><span class="n">pbd</span><span class="o">.</span><span class="n">stable_entries</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">[</span><span class="n">pH_range</span><span class="p">,</span> <span class="n">V_range</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">pH_output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">voltage_output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">multiEntry</span> <span class="ow">in</span> <span class="n">lst_multiEntry</span><span class="p">:</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">target_comp_vertices</span> <span class="o">=</span> <span class="n">stable_domains</span><span class="p">[</span><span class="n">multiEntry</span><span class="p">]</span>

                <span class="n">centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">target_comp_vertices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">target_comp_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">target_comp_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
                <span class="n">target_comp_vertices</span> <span class="o">=</span> <span class="n">target_comp_vertices</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">pH_output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                <span class="n">voltage_output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                <span class="k">continue</span>

            <span class="c1"># combine the water stable region with the stable region of target compounds</span>
            <span class="n">water_stable_region</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.23</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mf">1.23</span><span class="o">-</span><span class="mf">0.059</span><span class="o">*</span><span class="mi">14</span><span class="p">],</span>
                <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mf">0.059</span><span class="o">*</span><span class="mi">14</span><span class="p">]</span>
            <span class="p">])</span>
            <span class="n">centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">water_stable_region</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">water_stable_region</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">water_stable_region</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
            <span class="n">water_stable_region</span> <span class="o">=</span> <span class="n">water_stable_region</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>

            <span class="n">p_intersect</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">target_comp_vertices</span><span class="p">)</span>
            <span class="n">p_intersect</span> <span class="o">=</span> <span class="n">p_intersect</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">Polygon</span><span class="p">(</span><span class="n">water_stable_region</span><span class="p">))</span>

            <span class="n">target_comp_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">p_intersect</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_comp_vertices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pH_output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                <span class="n">voltage_output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                <span class="k">continue</span>

            <span class="n">pH_min</span><span class="p">,</span> <span class="n">pH_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">target_comp_vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">target_comp_vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">voltage_min_SHE</span><span class="p">,</span> <span class="n">voltage_max_SHE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">target_comp_vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">target_comp_vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">voltage_min_RHE</span><span class="p">,</span> <span class="n">voltage_max_RHE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">target_comp_vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.059</span><span class="o">*</span><span class="n">target_comp_vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">target_comp_vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.059</span><span class="o">*</span><span class="n">target_comp_vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">pH_output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pH_min</span><span class="p">,</span> <span class="n">pH_max</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">voltage_scale</span> <span class="o">==</span> <span class="s1">&#39;SHE&#39;</span><span class="p">:</span>
                <span class="n">voltage_output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">voltage_min_SHE</span><span class="p">,</span> <span class="n">voltage_max_SHE</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">voltage_scale</span> <span class="o">==</span> <span class="s1">&#39;RHE&#39;</span><span class="p">:</span>
                <span class="n">voltage_output</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">voltage_min_RHE</span><span class="p">,</span> <span class="n">voltage_max_RHE</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">pH_output</span><span class="p">,</span> <span class="n">voltage_output</span><span class="p">,</span> <span class="n">lst_multiEntry</span>

    <span class="k">def</span> <span class="nf">getDecompPhases</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_comp</span><span class="p">,</span> <span class="n">ehull_cut</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the decomposition phases</span>

<span class="sd">        Keyword argument:</span>
<span class="sd">        * target_comp: The target composition.</span>
<span class="sd">        * ehull_cut: The cutoff energy of the energy above hull (E_hull) (float, default is 0.0 eV/atom)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target_comp</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">target_comp_name</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ele_lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

        <span class="n">USER_API_KEY</span> <span class="o">=</span> <span class="s1">&#39;HgxDEuZIOSRIDxNncSMKLVBi5NCk36W3&#39;</span>

        <span class="k">with</span> <span class="n">MPRester</span><span class="p">(</span><span class="n">USER_API_KEY</span><span class="p">)</span> <span class="k">as</span> <span class="n">MPR</span><span class="p">:</span>
            <span class="n">entries</span> <span class="o">=</span> <span class="n">MPR</span><span class="o">.</span><span class="n">get_entries_in_chemsys</span><span class="p">(</span>
                <span class="n">ele_lst</span><span class="p">,</span>
                <span class="n">property_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;energy_above_hull&#39;</span><span class="p">],</span>
                <span class="n">inc_structure</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="n">additional_criteria</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy_above_hull&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ehull_cut</span><span class="p">),</span>
                                    <span class="s2">&quot;thermo_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;GGA_GGA+U&quot;</span><span class="p">]}</span>
            <span class="p">)</span>

        <span class="c1"># found target_entry</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
            <span class="n">entry_name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entry_name</span> <span class="o">==</span> <span class="n">target_comp_name</span><span class="p">:</span>
                <span class="n">target_entry</span> <span class="o">=</span> <span class="n">entry</span>
                <span class="k">break</span>

        <span class="c1"># we want to check the decomposition phase without the ground state</span>
        <span class="n">entries</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target_entry</span><span class="p">)</span>

        <span class="c1"># get the simplest of phaseDiagram.</span>
        <span class="n">pd</span> <span class="o">=</span> <span class="n">PhaseDiagram</span><span class="p">(</span><span class="n">entries</span><span class="p">)</span>

        <span class="c1"># we want to find out the combination without the target_entry</span>
        <span class="n">target_entry</span> <span class="o">=</span> <span class="n">ComputedEntry</span><span class="p">(</span><span class="n">composition</span><span class="o">=</span><span class="n">target_comp</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">decomp</span><span class="p">,</span> <span class="n">ehull</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_decomp_and_e_above_hull</span><span class="p">(</span><span class="n">target_entry</span><span class="p">)</span>

        <span class="n">lst_output</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp_comp</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tmp_comp</span> <span class="ow">in</span> <span class="n">decomp</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">lst_output</span>

    <span class="c1">########################## In below are helper functions for this class ##########################</span>
    <span class="k">def</span> <span class="nf">__getPourbaixDiagram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c_ion</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private function for generating Pourbaix Diagram.</span>

<span class="sd">        Keyword arguments:</span>
<span class="sd">        * comp: The composition that we want to get the Pourbaix diagram (string)</span>
<span class="sd">        * c_ion: The concentration of the ion (float, default is 1.0M)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># generate the pourbaix diagram</span>
        <span class="n">mpr</span> <span class="o">=</span> <span class="n">MPRester</span><span class="p">(</span><span class="s1">&#39;HgxDEuZIOSRIDxNncSMKLVBi5NCk36W3&#39;</span><span class="p">)</span>
        <span class="n">comp_dict</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="n">ele_lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">comp_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">pb_entries</span> <span class="o">=</span> <span class="n">mpr</span><span class="o">.</span><span class="n">get_pourbaix_entries</span><span class="p">(</span><span class="n">ele_lst</span><span class="p">,</span><span class="n">solid_compat</span><span class="o">=</span><span class="s1">&#39;MaterialsProject2020Compatibility&#39;</span><span class="p">)</span>
        <span class="n">tmp_comp_dict</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">fractional_composition</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="n">comp_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">tmp_comp_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">el</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;O&#39;</span><span class="p">,</span> <span class="s1">&#39;H&#39;</span><span class="p">]:</span>
                <span class="n">comp_dict</span><span class="p">[</span><span class="n">el</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>
        <span class="n">conc_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">ele</span><span class="p">:</span><span class="n">c_ion</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">ele_lst</span><span class="p">}</span>

        <span class="n">pbd</span> <span class="o">=</span> <span class="n">PourbaixDiagram</span><span class="p">(</span><span class="n">pb_entries</span><span class="p">,</span><span class="n">filter_solids</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">comp_dict</span><span class="o">=</span><span class="n">comp_dict</span><span class="p">,</span><span class="n">conc_dict</span><span class="o">=</span><span class="n">conc_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pbd</span>

    <span class="k">def</span> <span class="nf">__findTargetEntry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target_comp</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Private function for finding the entry for the target_comp in the PourbaixDiagram</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_entry</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># if not found, then it is None</span>
        <span class="n">pbd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pbd</span>
        <span class="n">target_formula</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="n">target_comp</span><span class="p">)</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">stable_domains</span> <span class="o">=</span> <span class="n">pbd</span><span class="o">.</span><span class="n">get_pourbaix_domains</span><span class="p">(</span><span class="n">pbd</span><span class="o">.</span><span class="n">stable_entries</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">[[</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1">################### find target_entry ###################</span>
        <span class="n">all_multiEntry</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">multiEntry</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">stable_domains</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>

            <span class="c1"># we only want solid phase to compare</span>
            <span class="n">isAllSolid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="s1">&#39;phase_type&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">multiEntry</span><span class="p">):</span>
            <span class="c1"># isinstance(multiEntry, PourbaixEntry):</span>
                <span class="k">if</span> <span class="s1">&#39;Solid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">multiEntry</span><span class="o">.</span><span class="n">phase_type</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">multiEntry</span><span class="o">.</span><span class="n">entry_list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s1">&#39;Solid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entry</span><span class="o">.</span><span class="n">phase_type</span><span class="p">:</span>
                        <span class="n">isAllSolid</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># if the entry is in the multiEntry, then return multiEntry</span>
                        <span class="n">formula</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">formula</span> <span class="o">==</span> <span class="n">target_formula</span><span class="p">:</span>
                            <span class="n">all_multiEntry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiEntry</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">isAllSolid</span><span class="p">:</span>
                    <span class="k">continue</span>

            <span class="n">formula</span> <span class="o">=</span> <span class="n">multiEntry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">target_formula</span> <span class="o">==</span> <span class="n">formula</span><span class="p">:</span>
                <span class="n">all_multiEntry</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">multiEntry</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_multiEntry</span>
</pre></div>
</div>
</div>
</details><p>This is the code for <code class="code docutils literal notranslate"><span class="pre">util_aqueous_stability.py</span></code> file, which contains some utility functions for the aqueous stability analysis. Also all the figures can be generated by using the functions in this file.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3 sd-fade-in">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">util_aqueous_stability.py</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<div class="code python highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Utility functions for aqueous stability analysis and visualization.</span>

<span class="sd">This module provides various helper functions for:</span>
<span class="sd">- Loading and processing pourbaix diagram data</span>
<span class="sd">- Analyzing stability regions of compounds</span>
<span class="sd">- Generating and plotting stability distributions</span>
<span class="sd">- Creating synergistic and antagonistic effect maps</span>
<span class="sd">- Visualizing binary data on element grids</span>

<span class="sd">Key functionalities include handling composition data, calculating stability ranges,</span>
<span class="sd">plotting pourbaix domains, and creating various visualizations for aqueous stability analysis.</span>

<span class="sd">Functions summary:</span>
<span class="sd">- load_pkl(pkl_path)</span>
<span class="sd">- get_pbd_name_from_comp(comp)</span>
<span class="sd">- get_solid_entry(pbd, pH_range, V_range)</span>
<span class="sd">- get_min_max(lst_lsts)</span>
<span class="sd">- score_pH(lst_pH)</span>
<span class="sd">- score_voltage(lst_voltage)</span>
<span class="sd">- getDecomp(comp_name, ehull_cut=0)</span>
<span class="sd">- get_vertices(all_pbd, dct_pH_V_range, family, comp, pH_range, V_range)</span>
<span class="sd">- isBalanced(reactants, products)</span>
<span class="sd">- check_polygons_overlap(polygons)</span>
<span class="sd">- get_vertices_overlap(all_pbd, dct_pH_V_range, lst_comp, lst_family)</span>
<span class="sd">- plot_vertices_overlap(all_pbd, dct_pH_V_range, lst_comp, lst_family, is_save=False, filename=&#39;&#39;, **kwargs)</span>
<span class="sd">- get_ion_output_string(input_string, pattern=r&#39;(\w+)\[([+-])(\d+)\]&#39;)</span>
<span class="sd">- is_point_in_polygon(point, polygon)</span>
<span class="sd">- get_stability_distribution(all_pbd, dct_pH_V_range, family, pH_range, voltage_range, step)</span>
<span class="sd">- plot_stability_distribution_with_examples(family, selected_comps, is_save=False, filename=&#39;&#39;, norm=&#39;linear&#39;, with_legend=False, pH_range=[0,14], V_range=[-4,4], step=0.02)</span>
<span class="sd">- sortedElLst(comp)</span>
<span class="sd">- isStable(dct)</span>
<span class="sd">- isAllExist(dct_all, lst_comp)</span>
<span class="sd">- checkSyn(all_pbd, dct_pH_V_all, dct_all, comp, comp1, comp2, lst_family)</span>
<span class="sd">- checkAnt(dct_all, comp, comp1, comp2)</span>
<span class="sd">- getMetal(oxide)</span>
<span class="sd">- plot_bi_data(arr, sorted_lst_elements, label_1, label_2, colormap_1, colormap_2, num_ticks_1, num_ticks_2, is_save=False, filename=&#39;&#39;)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># import packages if you want to use the functions</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">import os</span>
<span class="sd">import sys</span>
<span class="sd">parent_dir = os.path.dirname(os.getcwd())</span>
<span class="sd">sys.path.append(parent_dir)</span>

<span class="sd">from aqueous_stability import AqueousStabilityWorker</span>
<span class="sd">from util_aqueous_stability import *</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">to_rgba_array</span>
<span class="kn">from</span> <span class="nn">mp_api.client</span> <span class="kn">import</span> <span class="n">MPRester</span>
<span class="kn">from</span> <span class="nn">monty.serialization</span> <span class="kn">import</span> <span class="n">loadfn</span><span class="p">,</span> <span class="n">dumpfn</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Composition</span>
<span class="kn">from</span> <span class="nn">pymatgen.core.periodic_table</span> <span class="kn">import</span> <span class="n">Element</span>
<span class="kn">from</span> <span class="nn">pymatgen.analysis.phase_diagram</span> <span class="kn">import</span> <span class="n">PhaseDiagram</span>
<span class="kn">from</span> <span class="nn">pymatgen.entries.computed_entries</span> <span class="kn">import</span> <span class="n">ComputedEntry</span>
<span class="kn">from</span> <span class="nn">pymatgen.analysis.reaction_calculator</span> <span class="kn">import</span> <span class="n">Reaction</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Zhengda He&#39;</span>
<span class="n">__date__</span> <span class="o">=</span> <span class="s1">&#39;2024-09-27&#39;</span>
<span class="n">__email__</span> <span class="o">=</span> <span class="s1">&#39;zhengdahe.electrocatalysis@gmail.com&#39;</span>

<span class="k">def</span> <span class="nf">load_pkl</span><span class="p">(</span><span class="n">pkl_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load pickle file.</span>

<span class="sd">    The reason why we use pickle is because it is faster than mson since it is serialized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">pkl_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Loading </span><span class="si">{</span><span class="n">pkl_path</span><span class="si">}</span><span class="s1"> takes </span><span class="si">{</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="k">def</span> <span class="nf">get_pbd_name_from_comp</span><span class="p">(</span><span class="n">comp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    e.g. LiOH --&gt; H-O-Li</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">comp_obj</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
    <span class="n">ele_lst</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">comp_obj</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">])</span>
    <span class="n">sorted_ele_lst</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ele_lst</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">Element</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sorted_ele_lst</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">name</span>

<span class="k">def</span> <span class="nf">get_solid_entry</span><span class="p">(</span><span class="n">pbd</span><span class="p">,</span> <span class="n">pH_range</span><span class="p">,</span> <span class="n">V_range</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all solid entry from a pourbaix diagram.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lst_solids_comp</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stable_domains</span> <span class="o">=</span> <span class="n">pbd</span><span class="o">.</span><span class="n">get_pourbaix_domains</span><span class="p">(</span><span class="n">pbd</span><span class="o">.</span><span class="n">stable_entries</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">[</span><span class="n">pH_range</span><span class="p">,</span> <span class="n">V_range</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">multiEntry</span><span class="p">,</span> <span class="n">vertices</span> <span class="ow">in</span> <span class="n">stable_domains</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;phase_type&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">multiEntry</span><span class="p">):</span>
            <span class="k">if</span> <span class="s1">&#39;Solid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">multiEntry</span><span class="o">.</span><span class="n">phase_type</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">comp_multiEntry</span> <span class="o">=</span> <span class="n">multiEntry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">comp_multiEntry</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lst_solids_comp</span><span class="p">:</span>
                    <span class="n">lst_solids_comp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp_multiEntry</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">multiEntry</span><span class="o">.</span><span class="n">entry_list</span><span class="p">:</span>
                <span class="n">comp_entry</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">phase_type</span> <span class="o">==</span> <span class="s1">&#39;Solid&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">comp_entry</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lst_solids_comp</span><span class="p">:</span>
                        <span class="n">lst_solids_comp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">comp_entry</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lst_solids_comp</span>

<span class="k">def</span> <span class="nf">get_min_max</span><span class="p">(</span><span class="n">lst_lsts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the minimal and maximal values from a list of lists. Notice there will be [None, None] in the list.</span>

<span class="sd">    The format of pH_range is: [[pH_min, pH_max], [pH_min, pH_max], ...], this is because composition can be stable at different PourbaixMultiEntry, which corresponds to different stable regions, that&#39;s why we need to return a list of [pH_min, pH_max]. In here we also have an assumption that there are no gaps between different regions, which means all the stable regions are connected.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmp_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">lst_lsts</span><span class="p">:</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
            <span class="n">tmp_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp_lst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">np_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_lst</span><span class="p">)</span>
        <span class="n">lst_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np_arr</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">lst_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np_arr</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">lst_min</span><span class="p">,</span> <span class="n">lst_max</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>

<span class="c1"># the following score functions are used to sort the stability region.</span>
<span class="c1"># for pH, we want the low pH boarder to be as close to 0 as possible, then we consider the range of pH.</span>
<span class="c1"># for voltage, we want the high voltage boarder to be as close to 1.23 as possible, then we consider the range of voltage.</span>
<span class="k">def</span> <span class="nf">score_pH</span><span class="p">(</span><span class="n">lst_pH</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">14</span><span class="o">-</span><span class="n">lst_pH</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">lst_pH</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lst_pH</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">score_voltage</span><span class="p">(</span><span class="n">lst_voltage</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">lst_voltage</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">100</span> <span class="o">+</span> <span class="p">(</span><span class="n">lst_voltage</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lst_voltage</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># only get the binary oxides</span>
<span class="k">def</span> <span class="nf">getDecomp</span><span class="p">(</span><span class="n">comp_name</span><span class="p">,</span> <span class="n">ehull_cut</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_dim</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    get the decomposition phase of a given compound. All the competing phases are binary oxides.</span>
<span class="sd">    max_dim: the maximal dimension of the competing phases. Default is 2 (binary oxides), but we also want to test when max_dim = 3.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">comp_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">target_comp_name</span> <span class="o">=</span> <span class="n">comp</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ele_lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">comp</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="n">USER_API_KEY</span> <span class="o">=</span> <span class="s1">&#39;HgxDEuZIOSRIDxNncSMKLVBi5NCk36W3&#39;</span>

    <span class="k">with</span> <span class="n">MPRester</span><span class="p">(</span><span class="n">USER_API_KEY</span><span class="p">)</span> <span class="k">as</span> <span class="n">MPR</span><span class="p">:</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">MPR</span><span class="o">.</span><span class="n">get_entries_in_chemsys</span><span class="p">(</span>
            <span class="n">ele_lst</span><span class="p">,</span>
            <span class="n">property_data</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;energy_above_hull&#39;</span><span class="p">],</span>
            <span class="n">inc_structure</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
            <span class="n">additional_criteria</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy_above_hull&quot;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">ehull_cut</span><span class="p">),</span>
                                   <span class="s2">&quot;thermo_types&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;GGA_GGA+U&quot;</span><span class="p">]}</span>
        <span class="p">)</span>

    <span class="n">lst_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="n">comp_dct</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;O&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">comp_dct</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comp_dct</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">comp_dct</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">max_dim</span><span class="p">):</span>
            <span class="n">lst_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

    <span class="c1"># add terminal entries</span>
    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">ele_lst</span><span class="p">:</span>
        <span class="n">lst_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ComputedEntry</span><span class="p">(</span><span class="n">composition</span><span class="o">=</span><span class="n">el</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="mf">1e5</span><span class="p">))</span>

    <span class="c1"># found target_entry</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">:</span>
        <span class="n">entry_name</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">entry_name</span> <span class="o">==</span> <span class="n">target_comp_name</span><span class="p">:</span>
            <span class="n">target_entry</span> <span class="o">=</span> <span class="n">entry</span>
            <span class="k">break</span>

    <span class="c1"># we want to check the decomposition phase without the ground state</span>
    <span class="n">lst_entries</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">target_entry</span><span class="p">)</span>

    <span class="c1"># get the simplest of phaseDiagram.</span>
    <span class="n">pd</span> <span class="o">=</span> <span class="n">PhaseDiagram</span><span class="p">(</span><span class="n">lst_entries</span><span class="p">)</span>

    <span class="c1"># we want to find out the combination without the target_entry</span>
    <span class="n">target_entry</span> <span class="o">=</span> <span class="n">ComputedEntry</span><span class="p">(</span><span class="n">composition</span><span class="o">=</span><span class="n">comp_name</span><span class="p">,</span> <span class="n">energy</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">decomp</span><span class="p">,</span> <span class="n">ehull</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_decomp_and_e_above_hull</span><span class="p">(</span><span class="n">target_entry</span><span class="p">)</span>

    <span class="n">lst_output</span> <span class="o">=</span> <span class="p">[</span><span class="n">tmp_comp</span><span class="o">.</span><span class="n">composition</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">tmp_comp</span> <span class="ow">in</span> <span class="n">decomp</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">lst_output</span>

<span class="k">def</span> <span class="nf">get_vertices</span><span class="p">(</span><span class="n">all_pbd</span><span class="p">,</span> <span class="n">dct_pH_V_range</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">pH_range</span><span class="p">,</span> <span class="n">V_range</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the combined vertices of a given compound.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target_formula</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">get_integer_formula_and_factor</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># get pourbaix diagram</span>
    <span class="n">pbd</span> <span class="o">=</span> <span class="n">all_pbd</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span>
    <span class="n">stable_domains</span> <span class="o">=</span> <span class="n">pbd</span><span class="o">.</span><span class="n">get_pourbaix_domains</span><span class="p">(</span><span class="n">pbd</span><span class="o">.</span><span class="n">stable_entries</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">[</span><span class="n">pH_range</span><span class="p">,</span> <span class="n">V_range</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">mod_stable_domains</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">multiEntry</span><span class="p">,</span> <span class="n">vertices</span> <span class="ow">in</span> <span class="n">stable_domains</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">name_key</span> <span class="o">=</span> <span class="n">multiEntry</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="n">name_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">mod_stable_domains</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">mod_stable_domains</span><span class="p">[</span><span class="n">name_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{</span><span class="n">multiEntry</span><span class="p">:</span><span class="n">vertices</span><span class="p">}]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mod_stable_domains</span><span class="p">[</span><span class="n">name_key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">multiEntry</span><span class="p">:</span><span class="n">vertices</span><span class="p">})</span>

    <span class="c1"># get entry</span>
    <span class="n">lst_comp_entry</span> <span class="o">=</span> <span class="n">dct_pH_V_range</span><span class="p">[</span><span class="n">family</span><span class="p">][</span><span class="n">comp</span><span class="p">][</span><span class="s1">&#39;lst_entries&#39;</span><span class="p">]</span>

    <span class="c1"># Because in the aqueous_stability.py, we have set the return value of pourbaix_domains to be [[None, None]] when there is no stable domain. This can be changed, but I&#39;m lazy to change it......</span>
    <span class="k">if</span> <span class="n">lst_comp_entry</span> <span class="o">==</span> <span class="p">[[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot find entries for </span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">lst_vertices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">lst_comp_entry</span><span class="p">:</span>
        <span class="n">name_entry</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span>
        <span class="n">lst_possible_entries</span> <span class="o">=</span> <span class="n">mod_stable_domains</span><span class="p">[</span><span class="n">name_entry</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">dct</span> <span class="ow">in</span> <span class="n">lst_possible_entries</span><span class="p">:</span>
            <span class="n">is_found</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">multiEntry</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dct</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">name_multiEntry</span> <span class="o">=</span> <span class="n">multiEntry</span><span class="o">.</span><span class="n">name</span>

            <span class="n">vertices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dct</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="s1">&#39;phase_type&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">multiEntry</span><span class="p">):</span>
                <span class="k">if</span> <span class="s1">&#39;Solid&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">multiEntry</span><span class="o">.</span><span class="n">phase_type</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">target_formula</span> <span class="ow">in</span> <span class="n">name_multiEntry</span><span class="p">:</span>
                        <span class="n">is_found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">target_formula</span> <span class="ow">in</span> <span class="n">name_multiEntry</span><span class="p">:</span>
                    <span class="n">is_found</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">is_found</span><span class="p">:</span>
                <span class="n">lst_vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>

    <span class="c1"># combine all vertices into one</span>
    <span class="c1"># Approximation:</span>
    <span class="c1"># 1. This approach assumes that the points form a simple polygon without intersecting edges.</span>
    <span class="c1"># 2. If the points represent multiple disjoint regions or complex geometries, you may need more advanced techniques to handle those cases.</span>

    <span class="c1"># Combine the vertices into one array (unordered)</span>
    <span class="n">combined_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">lst_vertices</span><span class="p">)</span>

    <span class="c1"># Step 1: Calculate the centroid (mean of the x and y coordinates)</span>
    <span class="n">centroid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">combined_vertices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Step 2: Calculate the angle of each point relative to the centroid</span>
    <span class="c1"># The angle is calculated using the arctangent of the slope between the point and the centroid</span>
    <span class="n">angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">combined_vertices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">combined_vertices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">centroid</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># Step 3: Sort the points by the angle</span>
    <span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">angles</span><span class="p">)</span>
    <span class="n">sorted_vertices</span> <span class="o">=</span> <span class="n">combined_vertices</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">sorted_vertices</span>

<span class="k">def</span> <span class="nf">isBalanced</span><span class="p">(</span><span class="n">reactants</span><span class="p">,</span> <span class="n">products</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">reaction</span> <span class="o">=</span> <span class="n">Reaction</span><span class="p">(</span><span class="n">reactants</span><span class="p">,</span> <span class="n">products</span><span class="p">)</span>
        <span class="n">count_positive</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">reaction</span><span class="o">.</span><span class="n">coeffs</span><span class="p">:</span>
            <span class="c1"># there is composition which doesn&#39;t contribute</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="mi">0</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">1e-3</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">count_positive</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">count_positive</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="c1"># check whether a series of polygons intersect with each other or not --- super important for aqueous stability project</span>
<span class="k">def</span> <span class="nf">check_polygons_overlap</span><span class="p">(</span><span class="n">polygons</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    check whether a series of polygons intersect with each other or not</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
    <span class="n">p_intersect</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">polygons</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygons</span><span class="p">)):</span>
        <span class="n">poly_p</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">polygons</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">p_intersect</span><span class="o">.</span><span class="n">intersects</span><span class="p">(</span><span class="n">poly_p</span><span class="p">):</span>
            <span class="c1"># print(&#39;p_intersect = &#39;, p_intersect)</span>
            <span class="c1"># print(&#39;poly_p = &#39;, poly_p)</span>
            <span class="n">p_intersect</span> <span class="o">=</span> <span class="n">p_intersect</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">poly_p</span><span class="p">,</span> <span class="n">grid_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="k">def</span> <span class="nf">get_vertices_overlap</span><span class="p">(</span><span class="n">all_pbd</span><span class="p">,</span> <span class="n">dct_pH_V_range</span><span class="p">,</span> <span class="n">lst_comp</span><span class="p">,</span> <span class="n">lst_family</span><span class="p">):</span>
    <span class="n">lst_vertices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">dct_vertices</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst_comp</span><span class="p">):</span>
        <span class="n">family</span> <span class="o">=</span> <span class="n">lst_family</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">get_vertices</span><span class="p">(</span><span class="n">all_pbd</span><span class="p">,</span> <span class="n">dct_pH_V_range</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">vertices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s1"> cannot find vertices&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lst_vertices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
            <span class="n">dct_vertices</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertices</span>

    <span class="k">return</span> <span class="n">check_polygons_overlap</span><span class="p">(</span><span class="n">polygons</span><span class="o">=</span><span class="n">lst_vertices</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_vertices_overlap</span><span class="p">(</span><span class="n">all_pbd</span><span class="p">,</span> <span class="n">dct_pH_V_range</span><span class="p">,</span> <span class="n">lst_comp</span><span class="p">,</span> <span class="n">lst_family</span><span class="p">,</span> <span class="n">is_save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>

    <span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

    <span class="n">x_min</span> <span class="o">=</span> <span class="mi">99999</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99999</span>
    <span class="n">y_min</span> <span class="o">=</span> <span class="mi">99999</span>
    <span class="n">y_max</span> <span class="o">=</span> <span class="o">-</span><span class="mi">99999</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lst_comp</span><span class="p">):</span>

        <span class="n">family</span> <span class="o">=</span> <span class="n">lst_family</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="n">get_vertices</span><span class="p">(</span><span class="n">all_pbd</span><span class="p">,</span> <span class="n">dct_pH_V_range</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot find entry for </span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">vertices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot find vertices for </span><span class="si">{</span><span class="n">comp</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="c1"># get the range of the plot of pH and V</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">x_min</span><span class="p">:</span>
            <span class="n">x_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">x_max</span><span class="p">:</span>
            <span class="n">x_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">y_min</span><span class="p">:</span>
            <span class="n">y_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">y_max</span><span class="p">:</span>
            <span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">zorder</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zorder</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                          <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">to_rgba_array</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]),</span>
                          <span class="n">linewidth</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="n">Composition</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">to_latex_string</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
                          <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x_min</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="n">x_max</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="o">-</span><span class="mf">0.059</span><span class="o">*</span><span class="mi">14</span><span class="p">,</span><span class="n">y_min</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.23</span><span class="p">,</span><span class="n">y_max</span><span class="p">))</span>
    <span class="c1"># ax.set_xlim(0, 14)</span>
    <span class="c1"># ax.set_ylim(0-14*0.059-0.1, 1.23+0.1)</span>

    <span class="c1"># set the figure</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;labelsize&#39;</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;labelsize&#39;</span><span class="p">])</span>

    <span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_pad&#39;</span><span class="p">],</span> <span class="n">stop</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;x_pad&#39;</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xtick_num&#39;</span><span class="p">])</span>
    <span class="n">xticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xticks</span><span class="p">]</span>

    <span class="n">yticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_pad&#39;</span><span class="p">],</span> <span class="n">stop</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_pad&#39;</span><span class="p">],</span> <span class="n">num</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ytick_num&#39;</span><span class="p">])</span>
    <span class="n">yticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">y</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">yticks</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ticklabelsize&#39;</span><span class="p">])</span>

    <span class="c1"># lines for HER and ORR</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mf">0.059</span><span class="o">*</span><span class="mi">14</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.23</span><span class="p">,</span> <span class="mf">1.23</span><span class="o">-</span><span class="mf">0.059</span><span class="o">*</span><span class="mi">14</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;legendsize&#39;</span><span class="p">]},</span> <span class="n">ncol</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lst_comp</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Useful for Figure 5 and 6</span>
<span class="k">def</span> <span class="nf">get_ion_output_string</span><span class="p">(</span><span class="n">input_string</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;(\w+)\[([+-])(\d+)\]&#39;</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">replacement</span><span class="p">(</span><span class="n">match</span><span class="p">):</span>
        <span class="n">comp</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">comp_latex</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">to_latex_string</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">charge</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">fr</span><span class="s2">&quot;$\rm </span><span class="si">{</span><span class="n">comp_latex</span><span class="si">}</span><span class="s2">^</span><span class="se">{{</span><span class="si">{</span><span class="n">sign</span><span class="si">}</span><span class="se">}}</span><span class="s2">$&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">fr</span><span class="s2">&quot;$\rm </span><span class="si">{</span><span class="n">comp_latex</span><span class="si">}</span><span class="s2">^</span><span class="se">{{</span><span class="si">{</span><span class="n">charge</span><span class="si">}</span><span class="s2">\!\!</span><span class="si">{</span><span class="n">sign</span><span class="si">}</span><span class="se">}}</span><span class="s2">$&quot;</span>

    <span class="n">output_string</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">replacement</span><span class="p">,</span> <span class="n">input_string</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">output_string</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Useful for Figure_7 (stability distribution)</span>
<span class="k">def</span> <span class="nf">is_point_in_polygon</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">polygon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determines if a point is inside a polygon using the Ray Casting algorithm.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - point: Tuple or list with two elements representing the (x, y) coordinates of the point.</span>
<span class="sd">    - polygon: A list of tuples/lists with (x, y) coordinates of the polygon&#39;s vertices.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - True if the point is inside the polygon; False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span>
    <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="n">num</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">inside</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">):</span>
        <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">xj</span><span class="p">,</span> <span class="n">yj</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">intersect</span> <span class="o">=</span> <span class="p">((</span><span class="n">yi</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="p">(</span><span class="n">yj</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">))</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">xj</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">yi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">yj</span> <span class="o">-</span> <span class="n">yi</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">)</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">intersect</span><span class="p">:</span>
            <span class="n">inside</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">inside</span>
        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>

    <span class="k">return</span> <span class="n">inside</span>

<span class="k">def</span> <span class="nf">get_stability_distribution</span><span class="p">(</span><span class="n">all_pbd</span><span class="p">,</span> <span class="n">dct_pH_V_range</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">pH_range</span><span class="p">,</span> <span class="n">voltage_range</span><span class="p">,</span> <span class="n">step</span><span class="p">):</span>

    <span class="n">num_pH</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">pH_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pH_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>
    <span class="n">num_V</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">voltage_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">voltage_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>

    <span class="n">arr_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">num_V</span><span class="p">,</span> <span class="n">num_pH</span><span class="p">))</span>

    <span class="n">dct_comp_vertices</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">dct_pH_V_range</span><span class="p">[</span><span class="n">family</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())):</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">get_vertices</span><span class="p">(</span><span class="n">all_pbd</span><span class="p">,</span> <span class="n">dct_pH_V_range</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
        <span class="n">dct_comp_vertices</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span> <span class="o">=</span> <span class="n">vertices</span>

        <span class="k">if</span> <span class="n">vertices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">min_pH</span><span class="p">,</span> <span class="n">max_pH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">min_V</span><span class="p">,</span> <span class="n">max_V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">idx_pH_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">min_pH</span> <span class="o">-</span> <span class="n">pH_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>
        <span class="n">idx_pH_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_pH</span> <span class="o">-</span> <span class="n">pH_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>

        <span class="n">idx_V_min</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">min_V</span> <span class="o">-</span> <span class="n">voltage_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>
        <span class="n">idx_V_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">max_V</span> <span class="o">-</span> <span class="n">voltage_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">idx_pH</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_pH_min</span><span class="p">,</span> <span class="n">idx_pH_max</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">idx_V</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">idx_V_min</span><span class="p">,</span> <span class="n">idx_V_max</span><span class="p">):</span>

                <span class="n">tmp_pH</span> <span class="o">=</span> <span class="n">pH_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span><span class="o">*</span><span class="n">idx_pH</span>
                <span class="n">tmp_V</span> <span class="o">=</span> <span class="n">voltage_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">step</span><span class="o">*</span><span class="n">idx_V</span>

                <span class="k">if</span> <span class="n">is_point_in_polygon</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="p">(</span><span class="n">tmp_pH</span><span class="p">,</span> <span class="n">tmp_V</span><span class="p">),</span> <span class="n">polygon</span><span class="o">=</span><span class="n">vertices</span><span class="p">):</span>
                    <span class="n">arr_count</span><span class="p">[</span><span class="n">idx_V</span><span class="p">][</span><span class="n">idx_pH</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">dumpfn</span><span class="p">(</span><span class="n">arr_count</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">family</span><span class="si">}</span><span class="s1">_step_</span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s1">.mson&#39;</span><span class="p">)</span>
    <span class="n">dumpfn</span><span class="p">(</span><span class="n">dct_comp_vertices</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">family</span><span class="si">}</span><span class="s1">_comp_vertices.mson&#39;</span><span class="p">)</span>

<span class="c1"># Useful for Figure_7 (stability distribution)</span>
<span class="k">def</span> <span class="nf">plot_stability_distribution_with_examples</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">selected_comps</span><span class="p">,</span> <span class="n">is_save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">with_legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">pH_range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">14</span><span class="p">],</span> <span class="n">V_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.02</span><span class="p">):</span>

    <span class="kn">from</span> <span class="nn">matplotlib.patches</span> <span class="kn">import</span> <span class="n">Polygon</span> <span class="c1"># if this is not set, then the Polygon will be used in shapely</span>
    <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">to_rgba_array</span>

    <span class="n">labelsize</span> <span class="o">=</span> <span class="mi">24</span>
    <span class="n">ticklabelsize</span> <span class="o">=</span> <span class="mi">20</span>

    <span class="n">num_pH</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">pH_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">pH_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>

    <span class="n">arr_count</span> <span class="o">=</span> <span class="n">loadfn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">family</span><span class="si">}</span><span class="s1">_step_</span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s1">.mson&#39;</span><span class="p">)</span>
    <span class="n">dct_comp_vertices</span> <span class="o">=</span> <span class="n">loadfn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">family</span><span class="si">}</span><span class="s1">_comp_vertices.mson&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">arr_count</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;GnBu&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">arr_count</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;GnBu&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

    <span class="c1">#################### plot the vertices of selected compositions ####################</span>

    <span class="n">selected_colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#E2725B&#39;</span><span class="p">,</span> <span class="s1">&#39;#F2CB57&#39;</span><span class="p">,</span> <span class="s1">&#39;#32CD32&#39;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">comp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">selected_comps</span><span class="p">):</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">dct_comp_vertices</span><span class="p">[</span><span class="n">comp</span><span class="p">]</span>
        <span class="n">vertices_pH</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vertices_V</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">mod_vertices_pH</span> <span class="o">=</span> <span class="p">(</span><span class="n">vertices_pH</span> <span class="o">-</span> <span class="n">pH_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span>
        <span class="n">mod_vertices_V</span> <span class="o">=</span> <span class="p">(</span><span class="n">vertices_V</span> <span class="o">-</span> <span class="n">V_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span>

        <span class="n">mod_vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">mod_vertices_pH</span><span class="p">,</span> <span class="n">mod_vertices_V</span><span class="p">]))</span>

        <span class="c1"># print(mod_vertices)</span>

        <span class="k">if</span> <span class="n">comp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;CoHO2&#39;</span><span class="p">,</span> <span class="s1">&#39;AgHO2&#39;</span><span class="p">]:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">to_latex_string</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;$_</span><span class="si">{1}</span><span class="s1">$&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">comp</span> <span class="o">==</span> <span class="s1">&#39;CoHO2&#39;</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\rm CoOOH$&#39;</span>
            <span class="k">if</span> <span class="n">comp</span> <span class="o">==</span> <span class="s1">&#39;AgHO2&#39;</span><span class="p">:</span>
                <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\rm AgOOH$&#39;</span>

        <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">mod_vertices</span><span class="p">,</span> <span class="n">closed</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">selected_colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                          <span class="n">facecolor</span><span class="o">=</span><span class="n">to_rgba_array</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                          <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span>

    <span class="c1">####################################################################################</span>

    <span class="n">pH_lim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>
    <span class="n">idx_pH</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">pH_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">pH_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="n">pH_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">pH_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)]</span>

    <span class="n">V_lim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">idx_V</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">((</span><span class="n">V_lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">V_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="n">V_lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">V_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)]</span>

    <span class="n">num_pH_ticks</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">pH_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">idx_pH</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx_pH</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_pH_ticks</span><span class="p">)</span>
    <span class="n">pH_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">pH_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">pH</span><span class="p">)</span> <span class="k">for</span> <span class="n">pH</span> <span class="ow">in</span> <span class="n">pH_ticks</span><span class="p">]</span>

    <span class="n">num_V_ticks</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">V_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">idx_V</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">idx_V</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">num_V_ticks</span><span class="p">)</span>
    <span class="n">V_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">V_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">step</span><span class="o">*</span><span class="n">V</span><span class="p">)</span> <span class="k">for</span> <span class="n">V</span> <span class="ow">in</span> <span class="n">V_ticks</span><span class="p">]</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">pH_ticks</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">pH_labels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">V_ticks</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">V_labels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticklabelsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;E (V vs SHE)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">labelsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;pH&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">labelsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">idx_pH</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">idx_V</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

    <span class="c1"># determine the xticks for the colorbar</span>

    <span class="n">max_arrCount</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">arr_count</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">max_arrCount</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticklabelsize</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">max_arrCount</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticklabelsize</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">max_arrCount</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticklabelsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticklabelsize</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticklabelsize</span><span class="p">)</span>

    <span class="c1"># add HER/ORR/OER lines</span>
    <span class="n">idx_V_HER_pH0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">0</span> <span class="o">-</span> <span class="n">V_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>
    <span class="n">idx_V_HER_pH14</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mi">0</span> <span class="o">-</span> <span class="mf">0.059</span><span class="o">*</span><span class="mi">14</span> <span class="o">-</span> <span class="n">V_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>

    <span class="n">idx_V_ORR_pH0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mf">1.23</span> <span class="o">-</span> <span class="n">V_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>
    <span class="n">idx_V_ORR_pH14</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="mf">1.23</span> <span class="o">-</span> <span class="mf">0.059</span><span class="o">*</span><span class="mi">14</span> <span class="o">-</span> <span class="n">V_range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">step</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_pH</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">idx_V_HER_pH0</span><span class="p">,</span> <span class="n">idx_V_HER_pH14</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_pH</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="n">idx_V_ORR_pH0</span><span class="p">,</span> <span class="n">idx_V_ORR_pH14</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># show the legends</span>
    <span class="k">if</span> <span class="n">with_legend</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.22</span><span class="p">),</span> <span class="n">handlelength</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">handletextpad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">columnspacing</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                   <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">selected_comps</span><span class="p">),</span> <span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="n">ticklabelsize</span><span class="p">},</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_save</span><span class="p">:</span>
        <span class="c1"># pass</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">######## Helper functions for Figure 8 (synergistic and antagonistic effects) ########</span>
<span class="k">def</span> <span class="nf">sortedElLst</span><span class="p">(</span><span class="n">comp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a list of metal elements sorted by atomic number</span>
<span class="sd">    e.g. LiCoO2 --&gt; [&#39;Li&#39;, &#39;Co&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">comp_dct</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="n">comp</span><span class="p">)</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
    <span class="n">lst_el</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">comp_dct</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">el</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">el</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lst_el</span><span class="p">:</span>
                <span class="n">lst_el</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>
    <span class="n">sorted_lst_el</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lst_el</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Element</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">Z</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sorted_lst_el</span>

<span class="k">def</span> <span class="nf">isStable</span><span class="p">(</span><span class="n">dct</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether a composition is stable or not, just check whehter there is None in the pH_range and V_range.</span>
<span class="sd">    This function is related with the data structure we used in this work, which is:</span>
<span class="sd">    {</span>
<span class="sd">        &#39;pH&#39;: [[pH_min, pH_max], [pH_min, pH_max], ...],</span>
<span class="sd">        &#39;V&#39;: [[V_min, V_max], [V_min, V_max], ...],</span>
<span class="sd">        &#39;lst_entries&#39;: [PourbaixMultiEntry, PourbaixMultiEntry, ...]</span>
<span class="sd">    }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_stable</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">dct</span><span class="p">[</span><span class="s1">&#39;pH&#39;</span><span class="p">]:</span>
        <span class="c1"># as long as we find one region is not None, the composition is stable</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
            <span class="n">is_stable</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">is_stable</span>

<span class="k">def</span> <span class="nf">isAllExist</span><span class="p">(</span><span class="n">dct_all</span><span class="p">,</span> <span class="n">lst_comp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether all elements in lst_el can be stabilized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_all_exist</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">for</span> <span class="n">comp</span> <span class="ow">in</span> <span class="n">lst_comp</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">comp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dct_all</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span> <span class="c1"># comp is not even ground state</span>
            <span class="n">is_all_exist</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isStable</span><span class="p">(</span><span class="n">dct_all</span><span class="p">[</span><span class="n">comp</span><span class="p">]):</span> <span class="c1"># comp is not stable in water region</span>
                <span class="n">is_all_exist</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">is_all_exist</span>

<span class="k">def</span> <span class="nf">checkSyn</span><span class="p">(</span><span class="n">all_pbd</span><span class="p">,</span> <span class="n">dct_pH_V_all</span><span class="p">,</span> <span class="n">dct_all</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">comp1</span><span class="p">,</span> <span class="n">comp2</span><span class="p">,</span> <span class="n">lst_family</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether the composition fits the criteria of the synergestic map.</span>

<span class="sd">    Criteria is:</span>
<span class="sd">        condition1 = (comp1 is not stable) or (comp2 is not stable)</span>
<span class="sd">        condition2 = (comp1 is stable) and (comp2 is stable) and (comp1/comp2 do not have overlap)</span>
<span class="sd">        if condition1 or condition2:</span>
<span class="sd">            return True</span>
<span class="sd">        else:</span>
<span class="sd">            return False</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># make sure comp is stable</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">isStable</span><span class="p">(</span><span class="n">dct_all</span><span class="p">[</span><span class="n">comp</span><span class="p">]):</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># make sure comp1 and comp2 are ground states, otherwise do not consider</span>
    <span class="k">if</span> <span class="n">comp1</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dct_all</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">is_comp1_stable</span> <span class="o">=</span> <span class="n">isStable</span><span class="p">(</span><span class="n">dct_all</span><span class="p">[</span><span class="n">comp1</span><span class="p">])</span> <span class="c1"># check whether comp1 is stable in water region</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_comp1_stable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">comp2</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">dct_all</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">is_comp2_stable</span> <span class="o">=</span> <span class="n">isStable</span><span class="p">(</span><span class="n">dct_all</span><span class="p">[</span><span class="n">comp2</span><span class="p">])</span> <span class="c1"># check whether comp2 is stable in water region</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">is_comp2_stable</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">condition1</span> <span class="o">=</span> <span class="ow">not</span><span class="p">(</span><span class="n">is_comp1_stable</span> <span class="ow">and</span> <span class="n">is_comp2_stable</span><span class="p">)</span>
    <span class="n">condition2</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># if condition1 is True, condition2 doesn&#39;t matter</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">condition1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">get_vertices_overlap</span><span class="p">(</span><span class="n">all_pbd</span><span class="p">,</span> <span class="n">dct_pH_V_all</span><span class="p">,</span> <span class="p">[</span><span class="n">comp1</span><span class="p">,</span> <span class="n">comp2</span><span class="p">],</span> <span class="n">lst_family</span><span class="p">):</span> <span class="c1"># if overlap, then return False</span>
            <span class="n">condition2</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">condition2</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">condition1</span> <span class="ow">or</span> <span class="n">condition2</span>

<span class="k">def</span> <span class="nf">checkAnt</span><span class="p">(</span><span class="n">dct_all</span><span class="p">,</span> <span class="n">comp</span><span class="p">,</span> <span class="n">comp1</span><span class="p">,</span> <span class="n">comp2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check whether the composition fits the criteria of the antagonstic map.</span>

<span class="sd">    Criteria is:</span>
<span class="sd">        comp1 and comp2 are stable</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_comp_stable</span> <span class="o">=</span> <span class="n">isStable</span><span class="p">(</span><span class="n">dct_all</span><span class="p">[</span><span class="n">comp</span><span class="p">])</span>
    <span class="n">is_comp1_stable</span> <span class="o">=</span> <span class="n">isStable</span><span class="p">(</span><span class="n">dct_all</span><span class="p">[</span><span class="n">comp1</span><span class="p">])</span>
    <span class="n">is_comp2_stable</span> <span class="o">=</span> <span class="n">isStable</span><span class="p">(</span><span class="n">dct_all</span><span class="p">[</span><span class="n">comp2</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">is_comp1_stable</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">is_comp2_stable</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">is_comp_stable</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">getMetal</span><span class="p">(</span><span class="n">oxide</span><span class="p">):</span>
    <span class="n">comp_dct</span> <span class="o">=</span> <span class="n">Composition</span><span class="p">(</span><span class="n">oxide</span><span class="p">)</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">el</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">comp_dct</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">el</span> <span class="o">!=</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">el</span>

<span class="k">def</span> <span class="nf">plot_bi_data</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">sorted_lst_elements</span><span class="p">,</span> <span class="n">label_1</span><span class="p">,</span> <span class="n">label_2</span><span class="p">,</span> <span class="n">colormap_1</span><span class="p">,</span> <span class="n">colormap_2</span><span class="p">,</span> <span class="n">num_ticks_1</span><span class="p">,</span> <span class="n">num_ticks_2</span><span class="p">,</span> <span class="n">is_save</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>

    <span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
    <span class="kn">import</span> <span class="nn">matplotlib.ticker</span> <span class="k">as</span> <span class="nn">ticker</span>
    <span class="c1"># mpl.rc(&#39;font&#39;,family=&#39;Helvetica&#39;)</span>
    <span class="c1"># mpl.rc(&#39;font&#39;, **{&quot;sans-serif&quot;: [&quot;Helvetica&quot;], &#39;family&#39;:&#39;sans&#39;})</span>
    <span class="c1"># mpl.rc(&#39;mathtext&#39;, **{&#39;fontset&#39;: &#39;custom&#39;, &#39;rm&#39;: &#39;Helvetica&#39;})</span>

    <span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LinearSegmentedColormap</span><span class="p">,</span> <span class="n">to_rgba</span>
    <span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">colors</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

    <span class="n">element_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">el</span><span class="p">:</span><span class="s1">&#39;black&#39;</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">sorted_lst_elements</span><span class="p">}</span>

    <span class="n">labelsize</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">ticklabelsize</span> <span class="o">=</span> <span class="mi">28</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">element_colors</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">element_colors</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span>

    <span class="c1"># for the plot</span>
    <span class="n">tmp_data_surf</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="c1"># tmp_data_surf[tmp_data_surf == 0] = 1</span>

    <span class="c1"># Create masks for the lower and upper triangles</span>
    <span class="n">lower_triangle_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tril</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">tmp_data_surf</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">))</span>
    <span class="n">upper_triangle_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">triu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">tmp_data_surf</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Mask data arrays for lower and upper triangles</span>
    <span class="n">lower_triangle_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_data_surf</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">lower_triangle_mask</span><span class="p">)</span>

    <span class="n">min_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lower_triangle_data</span><span class="p">)</span>
    <span class="n">max_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lower_triangle_data</span><span class="p">)</span>

    <span class="n">upper_triangle_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tmp_data_surf</span><span class="p">,</span> <span class="n">mask</span><span class="o">=~</span><span class="n">upper_triangle_mask</span><span class="p">)</span>

    <span class="n">min_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">upper_triangle_data</span><span class="p">)</span>
    <span class="n">max_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">upper_triangle_data</span><span class="p">)</span>

    <span class="n">data_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">tmp_data_surf</span><span class="p">)</span>
    <span class="n">data_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">tmp_data_surf</span><span class="p">)</span>

    <span class="n">log_norm_lower</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">max_lower</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">log_norm_upper</span> <span class="o">=</span> <span class="n">colors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">max_upper</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># Create a figure and axis object</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span><span class="mi">16</span><span class="p">))</span>

    <span class="c1"># Plot lower triangle using the &quot;Greens&quot; colormap</span>
    <span class="c1"># cax1 = ax.imshow(lower_triangle_data, cmap=&#39;Greens&#39;)</span>
    <span class="n">cax1</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">lower_triangle_data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap_1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">log_norm_lower</span><span class="p">)</span>

    <span class="n">cbar1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">cbar1</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label_1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">cbar1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="n">num_ticks_1</span><span class="p">))</span>
    <span class="n">cbar1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">NullLocator</span><span class="p">())</span>
    <span class="n">cbar1_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">max_lower</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_ticks_1</span><span class="p">)</span>
    <span class="n">cbar1_ticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">cbar1_ticks</span><span class="p">]</span>
    <span class="n">cbar1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">cbar1_ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbar1_ticks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cbar1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">cbar1_ticks</span><span class="p">)</span>
    <span class="n">cbar1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">cbar1_ticklabels</span><span class="p">)</span>
    <span class="n">cbar1</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticklabelsize</span><span class="p">)</span>

    <span class="c1"># Plot upper triangle using the &quot;Purples&quot; colormap</span>
    <span class="c1"># cax2 = ax.imshow(upper_triangle_data, cmap=&#39;Purples&#39;)</span>
    <span class="n">cax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">upper_triangle_data</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap_2</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">log_norm_upper</span><span class="p">)</span>

    <span class="c1"># Add colorbar for upper triangle</span>
    <span class="n">cbar2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cax2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">log_norm_upper</span><span class="p">)</span>
    <span class="n">cbar2</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">label_2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">labelsize</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">cbar2_ticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">max_upper</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">num_ticks_2</span><span class="p">)</span>
    <span class="n">cbar2_ticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">round</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">cbar2_ticks</span><span class="p">]</span>
    <span class="n">cbar2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="n">num_ticks_2</span><span class="p">))</span>
    <span class="n">cbar2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">NullLocator</span><span class="p">())</span>
    <span class="n">cbar2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">cbar2_ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cbar2_ticks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cbar2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">cbar2_ticks</span><span class="p">)</span>
    <span class="n">cbar2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">cbar2_ticklabels</span><span class="p">)</span>
    <span class="n">cbar2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticklabelsize</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_lst_elements</span><span class="p">)),</span> <span class="n">sorted_lst_elements</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_lst_elements</span><span class="p">)),</span> <span class="n">sorted_lst_elements</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticklabelsize</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ticklabelsize</span><span class="p">)</span>

    <span class="c1"># x-elements</span>
    <span class="n">paddings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_lst_elements</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">paddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.04</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">tick_label</span><span class="p">,</span> <span class="n">padding</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">paddings</span><span class="p">):</span>

        <span class="n">tick_label</span><span class="o">.</span><span class="n">set_horizontalalignment</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span> <span class="o">=</span> <span class="n">tick_label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="n">tick_label</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span> <span class="o">-</span> <span class="n">padding</span><span class="p">))</span>
        <span class="n">tick_label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">element_colors</span><span class="p">[</span><span class="n">tick_label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()])</span>
        <span class="c1"># if element_colors[tick_label.get_text()] == &#39;green&#39;:</span>
        <span class="c1">#     tick_label.set_fontweight(&#39;bold&#39;)</span>

    <span class="c1"># y-elements</span>
    <span class="n">paddings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sorted_lst_elements</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">paddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">paddings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tick_label</span><span class="p">,</span> <span class="n">padding</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">paddings</span><span class="p">):</span>

        <span class="n">tick_label</span><span class="o">.</span><span class="n">set_verticalalignment</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
        <span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span> <span class="o">=</span> <span class="n">tick_label</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
        <span class="n">tick_label</span><span class="o">.</span><span class="n">set_position</span><span class="p">((</span><span class="n">x_pos</span> <span class="o">-</span> <span class="n">padding</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">))</span>
        <span class="n">tick_label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">element_colors</span><span class="p">[</span><span class="n">tick_label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()])</span>
        <span class="k">if</span> <span class="n">element_colors</span><span class="p">[</span><span class="n">tick_label</span><span class="o">.</span><span class="n">get_text</span><span class="p">()]</span> <span class="o">==</span> <span class="s1">&#39;green&#39;</span><span class="p">:</span>
            <span class="n">tick_label</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_save</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">.pdf&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details></section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Research Notes</p>
      </div>
    </a>
    <a class="right-next"
       href="../ML_potential/index.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Machine learning potential</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#abstract">Abstract</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methods">Methods</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#collect-a-dataset-of-metal-and-metal-oxy-hydr-oxide-compounds">Collect a dataset of metal and metal (oxy)(hydr)oxide compounds</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#collect-pourbaix-diagrams">Collect pourbaix diagrams</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#determine-the-stability-range-of-ph-and-voltage-for-each-compound">Determine the stability range of pH and voltage for each compound</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-analysis">Statistical analysis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-of-stable-regions">Distribution of stable regions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-of-binary-oxides">Stability of binary oxides</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-of-ternary-and-higher-order-oxides">Stability of ternary and higher-order oxides</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#synergistic-and-antagonistic-effects">Synergistic and Antagonistic effects</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#synergistic-effects">Synergistic effects</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#antagonistic-effects">Antagonistic effects</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion">Conclusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix">Appendix</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Zhengda He
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024, Zhengda He.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>